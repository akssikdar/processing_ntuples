# doc string
# make histosel
histosel: systs_files=syst-test.syst-list.1
histosel: n_proc=2
histosel: distrs_mc=distrs/distrs_v25v26resub2_mc_noqcd.root
histosel: distrs_data=../quick-test/v25v26-resub2_hadds/SingleMuon.root
histosel: out=histosels/redo-v25-v26_resub2_test-prallel
histosel: lumi=35800
histosel: chan=mu_sel
histosel: distr=Mt_lep_met_c
histosel: opt=
histosel:
	echo `date` histosel distrs_mc=${distrs_mc} distrs_data=${distrs_data} out=${out} chan=${chan} distr=${distr} systs_files=${systs_files} >> logs
	cat ${systs_files} | xargs -P ${n_proc} -I SYS sh -c "python stack_plot.py ${distrs_mc} ${distrs_data} -o ${out} --lumi ${lumi} -c ${chan} -d ${distr} ${opt} --wjet 1.4 --qcd 1.05 --systematic SYS || true"

plot_sig_bckg_shapes:


plot_sys_vars: histosel_file=histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root
plot_sys_vars: outdir=an-v7-and-paper-draft-3_answers/sys-vars/
plot_sys_vars:
	# all common systematics, except PDF (and alpha_s)
	for sysdef in PUUp,PUDown TOPPTUp,TOPPTDown bSFUp,bSFDown TESUp,TESDown JESUp,JESDown JERUp,JERDown FragUp,FragDown PetersonUp,PetersonDown SemilepBRUp,SemilepBRDown MfUp,MfDown MfrUp,MfrDown MrUp,MrDown ; \
	do \
	python mc_per_sys.py --ratio-range 0.1 --y-max 1500. ${histosel_file} -c el_sel_lj    -d Mt_lep_met_f -s $$sysdef --no-data --ratio  --add-titles --title-x "#font[12]{m}_{T} [GeV]" --title " " -o ${outdir} --outname el_sel_lj_all_Mt_lep_met_f_$$sysdef.png ; \
	python mc_per_sys.py --ratio-range 0.1 --y-max 1500. ${histosel_file} -c el_sel_ljout -d Mt_lep_met_f -s $$sysdef --no-data --ratio  --add-titles --title-x "#font[12]{m}_{T} [GeV]" --title " " -o ${outdir} --outname el_sel_ljout_all_Mt_lep_met_f_$$sysdef.png ; \
	python mc_per_sys.py --ratio-range 0.1 --y-max 2500. ${histosel_file} -c mu_sel_lj    -d Mt_lep_met_f -s $$sysdef --no-data --ratio  --add-titles --title-x "#font[12]{m}_{T} [GeV]" --title " " -o ${outdir} --outname mu_sel_lj_all_Mt_lep_met_f_$$sysdef.png ; \
	python mc_per_sys.py --ratio-range 0.1 --y-max 2500. ${histosel_file} -c mu_sel_ljout -d Mt_lep_met_f -s $$sysdef --no-data --ratio  --add-titles --title-x "#font[12]{m}_{T} [GeV]" --title " " -o ${outdir} --outname mu_sel_ljout_all_Mt_lep_met_f_$$sysdef.png ; \
	done
	# lep el systematics
	for sysdef in LEPelIDUp,LEPelIDDown LEPelTRGUp,LEPelTRGDown ; \
	do \
	python mc_per_sys.py --ratio-range 0.1 --y-max 1500 ${histosel_file} -c el_sel_lj    -d Mt_lep_met_f  -s $$sysdef --no-data --ratio  --add-titles --title-x "#font[12]{m}_{T} [GeV]" --title " " -o ${outdir} --outname el_sel_lj_all_Mt_lep_met_f_$$sysdef.png ; \
	python mc_per_sys.py --ratio-range 0.1 --y-max 1500 ${histosel_file} -c el_sel_ljout -d Mt_lep_met_f  -s $$sysdef --no-data --ratio  --add-titles --title-x "#font[12]{m}_{T} [GeV]" --title " " -o ${outdir} --outname el_sel_ljout_all_Mt_lep_met_f_$$sysdef.png ; \
	done
	# lep mu systematics
	for sysdef in LEPmuIDUp,LEPmuIDDown LEPmuTRGUp,LEPmuTRGDown ; \
	do \
	python mc_per_sys.py --ratio-range 0.1 --y-max 2500. ${histosel_file} -c mu_sel_lj    -d Mt_lep_met_f -s $$sysdef --no-data --ratio  --add-titles --title-x "#font[12]{m}_{T} [GeV]" --title " " -o ${outdir} --outname mu_sel_lj_all_Mt_lep_met_f_$$sysdef.png ; \
	python mc_per_sys.py --ratio-range 0.1 --y-max 2500. ${histosel_file} -c mu_sel_ljout -d Mt_lep_met_f -s $$sysdef --no-data --ratio  --add-titles --title-x "#font[12]{m}_{T} [GeV]" --title " " -o ${outdir} --outname mu_sel_ljout_all_Mt_lep_met_f_$$sysdef.png ; \
	done

plot_sys_vars_tau_ID_misID: mc=distrs/distrs_v25v26resub2_mc_noqcd.root
plot_sys_vars_tau_ID_misID: data_mu=../quick-test/v25v26-resub2_hadds/SingleMuon.root
plot_sys_vars_tau_ID_misID: data_el=../quick-test/v25v26-resub2_hadds/SingleElectron.root
plot_sys_vars_tau_ID_misID: output=plots/distrs_v25v26resub2_sys_var_tauID_misID/
plot_sys_vars_tau_ID_misID: data_nick=data_other
plot_sys_vars_tau_ID_misID: lumi_mu=35800
plot_sys_vars_tau_ID_misID: lumi_el=35800
plot_sys_vars_tau_ID_misID:
	# plots with the variations
	# NOMINAL
	python stack_plot.py ${mc} ${data_mu}  -o ${output}  -c mu_sel_lj    --data-nick ${data_nick} -d Mt_lep_met_f --bin-norm --lumi ${lumi_mu} --qcd 1.05 --overwrite --wjets 1.4
	python stack_plot.py ${mc} ${data_mu}  -o ${output}  -c mu_sel_ljout --data-nick ${data_nick} -d Mt_lep_met_f --bin-norm --lumi ${lumi_mu} --qcd 1.05 --overwrite --wjets 1.4
	python stack_plot.py ${mc} ${data_el}  -o ${output}  -c el_sel_lj    --data-nick ${data_nick} -d Mt_lep_met_f --bin-norm --lumi ${lumi_el} --qcd 1.05 --overwrite --wjets 1.4
	python stack_plot.py ${mc} ${data_el}  -o ${output}  -c el_sel_ljout --data-nick ${data_nick} -d Mt_lep_met_f --bin-norm --lumi ${lumi_el} --qcd 1.05 --overwrite --wjets 1.4
	# tauID
	# UP
	python stack_plot.py ${mc} ${data_mu}  -o ${output}  -c mu_sel_lj    --data-nick ${data_nick} -d Mt_lep_met_f --bin-norm --lumi ${lumi_mu} --qcd 1.05 --overwrite --wjets 1.4  --rename-sys TauIDDown --factor-rate-systematic tt_mutau,tt_eltau,tt_taultauh,s_top_mutau,s_top_eltau,s_top_other,dy_tautau:0.95
	python stack_plot.py ${mc} ${data_mu}  -o ${output}  -c mu_sel_ljout --data-nick ${data_nick} -d Mt_lep_met_f --bin-norm --lumi ${lumi_mu} --qcd 1.05 --overwrite --wjets 1.4  --rename-sys TauIDDown --factor-rate-systematic tt_mutau,tt_eltau,tt_taultauh,s_top_mutau,s_top_eltau,s_top_other,dy_tautau:0.95
	# UP
	python stack_plot.py ${mc} ${data_mu}  -o ${output}  -c mu_sel_lj    --data-nick ${data_nick} -d Mt_lep_met_f --bin-norm --lumi ${lumi_mu} --qcd 1.05 --overwrite --wjets 1.4  --rename-sys TauIDUp   --factor-rate-systematic tt_mutau,tt_eltau,tt_taultauh,s_top_mutau,s_top_eltau,s_top_other,dy_tautau:1.05
	python stack_plot.py ${mc} ${data_mu}  -o ${output}  -c mu_sel_ljout --data-nick ${data_nick} -d Mt_lep_met_f --bin-norm --lumi ${lumi_mu} --qcd 1.05 --overwrite --wjets 1.4  --rename-sys TauIDUp   --factor-rate-systematic tt_mutau,tt_eltau,tt_taultauh,s_top_mutau,s_top_eltau,s_top_other,dy_tautau:1.05
	#
	# same for el
	python stack_plot.py ${mc} ${data_el}  -o ${output}  -c el_sel_lj    --data-nick ${data_nick} -d Mt_lep_met_f --bin-norm --lumi ${lumi_el} --qcd 1.05 --overwrite --wjets 1.4  --rename-sys TauIDDown --factor-rate-systematic tt_mutau,tt_eltau,tt_taultauh,s_top_mutau,s_top_eltau,s_top_other,dy_tautau:0.95
	python stack_plot.py ${mc} ${data_el}  -o ${output}  -c el_sel_ljout --data-nick ${data_nick} -d Mt_lep_met_f --bin-norm --lumi ${lumi_el} --qcd 1.05 --overwrite --wjets 1.4  --rename-sys TauIDDown --factor-rate-systematic tt_mutau,tt_eltau,tt_taultauh,s_top_mutau,s_top_eltau,s_top_other,dy_tautau:0.95
	#
	python stack_plot.py ${mc} ${data_el}  -o ${output}  -c el_sel_lj    --data-nick ${data_nick} -d Mt_lep_met_f --bin-norm --lumi ${lumi_el} --qcd 1.05 --overwrite --wjets 1.4  --rename-sys TauIDUp   --factor-rate-systematic tt_mutau,tt_eltau,tt_taultauh,s_top_mutau,s_top_eltau,s_top_other,dy_tautau:1.05
	python stack_plot.py ${mc} ${data_el}  -o ${output}  -c el_sel_ljout --data-nick ${data_nick} -d Mt_lep_met_f --bin-norm --lumi ${lumi_el} --qcd 1.05 --overwrite --wjets 1.4  --rename-sys TauIDUp   --factor-rate-systematic tt_mutau,tt_eltau,tt_taultauh,s_top_mutau,s_top_eltau,s_top_other,dy_tautau:1.05
	# 
	# misID
	# DOWN
	python stack_plot.py  ${mc} ${data_mu} -o ${output} -c mu_sel_lj    --data-nick ${data_nick} -d Mt_lep_met_f --bin-norm --lumi ${lumi_mu} --qcd 1.05 --overwrite --wjets 1.4  --rename-sys TauMisIDDown --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj,dibosons:0.5
	python stack_plot.py  ${mc} ${data_mu} -o ${output} -c mu_sel_ljout --data-nick ${data_nick} -d Mt_lep_met_f --bin-norm --lumi ${lumi_mu} --qcd 1.05 --overwrite --wjets 1.4  --rename-sys TauMisIDDown --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj,dibosons:0.5
	# UP
	python stack_plot.py  ${mc} ${data_mu} -o ${output} -c mu_sel_lj    --data-nick ${data_nick} -d Mt_lep_met_f --bin-norm --lumi ${lumi_mu} --qcd 1.05 --overwrite --wjets 1.4  --rename-sys TauMisIDUp   --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj,dibosons:1.5
	python stack_plot.py  ${mc} ${data_mu} -o ${output} -c mu_sel_ljout --data-nick ${data_nick} -d Mt_lep_met_f --bin-norm --lumi ${lumi_mu} --qcd 1.05 --overwrite --wjets 1.4  --rename-sys TauMisIDUp   --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj,dibosons:1.5
	# for el
	python stack_plot.py  ${mc} ${data_el} -o ${output} -c el_sel_lj    --data-nick ${data_nick} -d Mt_lep_met_f --bin-norm --lumi ${lumi_el} --qcd 1.05 --overwrite --wjets 1.4  --rename-sys TauMisIDDown --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj,dibosons:0.5
	python stack_plot.py  ${mc} ${data_el} -o ${output} -c el_sel_ljout --data-nick ${data_nick} -d Mt_lep_met_f --bin-norm --lumi ${lumi_el} --qcd 1.05 --overwrite --wjets 1.4  --rename-sys TauMisIDDown --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj,dibosons:0.5
	#
	python stack_plot.py  ${mc} ${data_el} -o ${output} -c el_sel_lj    --data-nick ${data_nick} -d Mt_lep_met_f --bin-norm --lumi ${lumi_el} --qcd 1.05 --overwrite --wjets 1.4  --rename-sys TauMisIDUp   --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj,dibosons:1.5
	python stack_plot.py  ${mc} ${data_el} -o ${output} -c el_sel_ljout --data-nick ${data_nick} -d Mt_lep_met_f --bin-norm --lumi ${lumi_el} --qcd 1.05 --overwrite --wjets 1.4  --rename-sys TauMisIDUp   --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj,dibosons:1.5
	#
	hadd -f ${output}/distrs_histosel.root ${output}/distrs*root
	#
	python mc_per_sys.py --y-max 80.  ${output}/distrs_histosel.root -c el_sel_lj    -d Mt_lep_met_f -s TauIDUp,TauIDDown --no-data --ratio  --add-titles --title-x "#font[12]{m}_{T} [GeV]" --title " " -o ${output} --outname el_sel_lj_all_Mt_lep_met_f_TauIDUp,TauIDDown.png
	python mc_per_sys.py --y-max 80.  ${output}/distrs_histosel.root -c el_sel_ljout -d Mt_lep_met_f -s TauIDUp,TauIDDown --no-data --ratio  --add-titles --title-x "#font[12]{m}_{T} [GeV]" --title " " -o ${output} --outname el_sel_ljout_all_Mt_lep_met_f_TauIDUp,TauIDDown.png
	python mc_per_sys.py --y-max 150. ${output}/distrs_histosel.root -c mu_sel_lj    -d Mt_lep_met_f -s TauIDUp,TauIDDown --no-data --ratio  --add-titles --title-x "#font[12]{m}_{T} [GeV]" --title " " -o ${output} --outname mu_sel_lj_all_Mt_lep_met_f_TauIDUp,TauIDDown.png
	python mc_per_sys.py --y-max 150. ${output}/distrs_histosel.root -c mu_sel_ljout -d Mt_lep_met_f -s TauIDUp,TauIDDown --no-data --ratio  --add-titles --title-x "#font[12]{m}_{T} [GeV]" --title " " -o ${output} --outname mu_sel_ljout_all_Mt_lep_met_f_TauIDUp,TauIDDown.png
	#
	python mc_per_sys.py --y-max 80.  ${output}/distrs_histosel.root -c el_sel_lj    -d Mt_lep_met_f -s TauMisIDUp,TauMisIDDown --no-data --ratio  --add-titles --title-x "#font[12]{m}_{T} [GeV]" --title " " -o ${output} --outname el_sel_lj_all_Mt_lep_met_f_TauMisIDUp,TauMisIDDown.png
	python mc_per_sys.py --y-max 80.  ${output}/distrs_histosel.root -c el_sel_ljout -d Mt_lep_met_f -s TauMisIDUp,TauMisIDDown --no-data --ratio  --add-titles --title-x "#font[12]{m}_{T} [GeV]" --title " " -o ${output} --outname el_sel_ljout_all_Mt_lep_met_f_TauMisIDUp,TauMisIDDown.png
	python mc_per_sys.py --y-max 150. ${output}/distrs_histosel.root -c mu_sel_lj    -d Mt_lep_met_f -s TauMisIDUp,TauMisIDDown --no-data --ratio  --add-titles --title-x "#font[12]{m}_{T} [GeV]" --title " " -o ${output} --outname mu_sel_lj_all_Mt_lep_met_f_TauMisIDUp,TauMisIDDown.png
	python mc_per_sys.py --y-max 150. ${output}/distrs_histosel.root -c mu_sel_ljout -d Mt_lep_met_f -s TauMisIDUp,TauMisIDDown --no-data --ratio  --add-titles --title-x "#font[12]{m}_{T} [GeV]" --title " " -o ${output} --outname mu_sel_ljout_all_Mt_lep_met_f_TauMisIDUp,TauMisIDDown.png




hadd_distrs: nt=v37
hadd_distrs: proc=test1
hadd_distrs: distrs=bunch2
hadd_distrs: dtag=MC2016_Summer16_TTJets_powheg
hadd_distrs: max_procs=4
hadd_distrs:
	ls distrs/${nt}_${proc}_${distrs}/all/${dtag}/ | xargs -P ${max_procs} -I CHANS sh -c "hadd distrs/${nt}_${proc}_${distrs}/all/${dtag}/CHANS.root distrs/${nt}_${proc}_${distrs}/all/${dtag}/CHANS/*root"

multihadd2_distrs: nt=v37
multihadd2_distrs: proc=test1
multihadd2_distrs: distrs=bunch2
multihadd2_distrs: dtag=MC2016_Summer16_TTJets_powheg
multihadd2_distrs: size=30
multihadd2_distrs: max_procs=10
multihadd2_distrs:
	python multihadd2.py -i ${size} distrs/${nt}_${proc}_${distrs}/all/${dtag}/all_chans.root `find distrs/${nt}_${proc}_${distrs}/all/${dtag}/ -name "*root"` > temp.multihadd2_coms
	cat temp.multihadd2_coms | xargs -P ${max_procs} -d "\n" -I COMM sh -c "COMM || true"
	hadd distrs/${nt}_${proc}_${distrs}/all/${dtag}.root distrs/${nt}_${proc}_${distrs}/all/${dtag}/all_chans.root.*

# make multihadd2_distrs_all_dtags proc=test172 distrs=bunchFULLFIT1BIN1yield
# jobsums/distrs/v37_test172_bunchFULLFIT1BIN1yield/
multihadd2_distrs_all_dtags: nt=v37
multihadd2_distrs_all_dtags: proc=test1
multihadd2_distrs_all_dtags: distrs=bunch2
multihadd2_distrs_all_dtags: size=30
multihadd2_distrs_all_dtags: max_procs=10
multihadd2_distrs_all_dtags: dtag_pattern=""
multihadd2_distrs_all_dtags:
	for dtag in `ls distrs/${nt}_${proc}_${distrs}/all/ | grep ${dtag_pattern} | grep -v "\.root"`; \
	do \
	make multihadd2_distrs dtag=$$dtag nt=${nt} proc=${proc} distrs=${distrs} size=${size} max_procs=${max_procs} ; \
	done

# histosels for the full fit

# hadd ${merge_dir}/${nt}/${proc}/$$d.root /lstore/cms/olek/outdirs/${nt}/${proc}/$$d/*.root &
run_histos: systematics=NOMINAL
run_histos: mc=distrs/distrs_v25v26resub2_mc_noqcd.root
run_histos: data=../quick-test/v25v26-resub2_hadds/SingleMuon.root
run_histos: out=histosels/redo-v25-v26_resub2/
run_histos: lumi=35800
run_histos: chan=mu_sel
run_histos: distr=Mt_lep_met_f
run_histos: wjets_norm=0.8
run_histos: qcd_opt=
run_histos: shape_opt=
run_histos: data_nick=data_other
run_histos: options=
run_histos:
	for sys in ${systematics}; \
	do \
	python stack_plot.py ${mc} ${data} -o ${out} --data-nick ${data_nick} --lumi ${lumi} -c ${chan} -d ${distr} --wjet ${wjets_norm} ${qcd_opt} ${shape_opt} --systematic $$sys ${options} ; \
	done

test_cond: COND=DO
test_cond:
	echo foo `if [ "${COND}" = "DO" ] ; then echo 'shape_opt="-x mu_selVloose_lj"' ; fi`
	make run_histos --dry-run `if [ "${COND}" = "DO" ] ; then echo 'shape_opt="-x mu_selVloose_lj"' ; fi`

#make run_histos mc=${mc} data=${data_mu} lumi=${lumi_mu} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=mu_sel_lj    systematics="NOMINAL" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_lj" & \
make run_histos mc=${mc} data=${data_el} lumi=${lumi_el} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=el_sel_lj    systematics="NOMINAL" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_lj" & \
make run_histos mc=${mc} data=${data_mu} lumi=${lumi_mu} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=mu_sel_ljout systematics="NOMINAL" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_ljout" & \
make run_histos mc=${mc} data=${data_el} lumi=${lumi_el} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=el_sel_ljout systematics="NOMINAL" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_ljout" &
# tt modeling with no data-driven qcd
#make run_histos mc=${mc} data=${data_mu} lumi=${lumi_mu} distr=${distr} out=${out} chan=mu_sel_lj    systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.updowns syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_lj" &
#make run_histos mc=${mc} data=${data_el} lumi=${lumi_el} distr=${distr} out=${out} chan=el_sel_lj    systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.updowns syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_lj" & 
#make run_histos mc=${mc} data=${data_mu} lumi=${lumi_mu} distr=${distr} out=${out} chan=mu_sel_ljout systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.updowns syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_ljout" &
#make run_histos mc=${mc} data=${data_el} lumi=${lumi_el} distr=${distr} out=${out} chan=el_sel_ljout systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.updowns syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_ljout" & 

#make run_histos mc=${mc} data=${data_mu} lumi=${lumi_mu} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=mu_sel_lj    systematics="`cat syst-test.syst-list.experimental syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_lj" & \
#make run_histos mc=${mc} data=${data_el} lumi=${lumi_el} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=el_sel_lj    systematics="`cat syst-test.syst-list.experimental syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_lj" & \
#make run_histos mc=${mc} data=${data_mu} lumi=${lumi_mu} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=mu_sel_ljout systematics="`cat syst-test.syst-list.experimental syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_ljout" & \
#make run_histos mc=${mc} data=${data_el} lumi=${lumi_el} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=el_sel_ljout systematics="`cat syst-test.syst-list.experimental syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_ljout" & 

# ok, conditions are not first-class in makefiles
#run_histos: sys_file=syst-test.syst-list.1
run_std_histos: mc=distrs/distrs_v25v26resub2_mc_noqcd.root
run_std_histos: data_mu=../quick-test/v25v26-resub2_hadds/SingleMuon.root
run_std_histos: data_el=../quick-test/v25v26-resub2_hadds/SingleElectron.root
run_std_histos: out=histosels/redo-v25-v26_resub2/
run_std_histos: distr=Mt_lep_met_c
run_std_histos: lumi_mu=35800
run_std_histos: lumi_el=31300
run_std_histos: wjets_norm=0.8
run_std_histos: options=
run_std_histos:
	# log parameters
	echo mc=${mc} data_mu=${data_mu} data_el=${data_el} lumi_mu=${lumi_mu} lumi_el=${lumi_el} distr=${distr} out=${out} wjets_norm=${wjets_norm} options=${options} > ${out}/run_std_histos.params
	# the batch with data-driven QCD
	# the qcd has the experimental systematics, but not the TT modeling
	make run_histos mc=${mc} data=${data_mu} options=${options} lumi=${lumi_mu} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=mu_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_lj"    & \
	make run_histos mc=${mc} data=${data_el} options=${options} lumi=${lumi_el} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=el_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_lj"    & \
	make run_histos mc=${mc} data=${data_mu} options=${options} lumi=${lumi_mu} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=mu_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose_ljout" & \
	make run_histos mc=${mc} data=${data_el} options=${options} lumi=${lumi_el} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=el_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose_ljout" & \
	# no updowns now
	make run_histos mc=${mc} data=${data_mu} options=${options} lumi=${lumi_mu} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=mu_sel_lj    systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_lj" & \
	make run_histos mc=${mc} data=${data_el} options=${options} lumi=${lumi_el} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=el_sel_lj    systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_lj" & \
	make run_histos mc=${mc} data=${data_mu} options=${options} lumi=${lumi_mu} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=mu_sel_ljout systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_ljout" & \
	make run_histos mc=${mc} data=${data_el} options=${options} lumi=${lumi_el} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=el_sel_ljout systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x el_selVloose_ljout" & \
	#
	make run_histos mc=${mc} data=${data_mu} options=${options} lumi=${lumi_mu} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=mu_sel & \
	make run_histos mc=${mc} data=${data_el} options=${options} lumi=${lumi_el} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=el_sel & 

run_std_histos_noqcd: mc=distrs/distrs_v25v26resub2_mc_noqcd.root
run_std_histos_noqcd: data_mu=../quick-test/v25v26-resub2_hadds/SingleMuon.root
run_std_histos_noqcd: data_el=../quick-test/v25v26-resub2_hadds/SingleElectron.root
run_std_histos_noqcd: out=histosels/redo-v25-v26_resub2/
run_std_histos_noqcd: distr=Mt_lep_met_c
run_std_histos_noqcd: lumi_mu=35800
run_std_histos_noqcd: lumi_el=31300
run_std_histos_noqcd: wjets_norm=0.8
run_std_histos_noqcd:
	# log parameters
	echo mc=${mc} data_mu=${data_mu} data_el=${data_el} lumi_mu=${lumi_mu} lumi_el=${lumi_el} distr=${distr} out=${out} wjets_norm=${wjets_norm} > ${out}/run_std_histos.params
	# the batch with data-driven QCD
	# the qcd has the experimental systematics, but not the TT modeling
	make run_histos mc=${mc} data=${data_mu} lumi=${lumi_mu} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=mu_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--skip-QCD" shape_opt="-x mu_selVloose_lj" & \
	make run_histos mc=${mc} data=${data_el} lumi=${lumi_el} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=el_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--skip-QCD" shape_opt="-x el_selVloose_lj" & \
	make run_histos mc=${mc} data=${data_mu} lumi=${lumi_mu} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=mu_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--skip-QCD" shape_opt="-x mu_selVloose_ljout" & \
	make run_histos mc=${mc} data=${data_el} lumi=${lumi_el} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=el_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--skip-QCD" shape_opt="-x el_selVloose_ljout" & \
	# no updowns now
	make run_histos mc=${mc} data=${data_mu} lumi=${lumi_mu} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=mu_sel_lj    systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" qcd_opt="--skip-QCD" shape_opt="-x mu_selVloose_lj" & \
	make run_histos mc=${mc} data=${data_el} lumi=${lumi_el} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=el_sel_lj    systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" qcd_opt="--skip-QCD" shape_opt="-x el_selVloose_lj" & \
	make run_histos mc=${mc} data=${data_mu} lumi=${lumi_mu} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=mu_sel_ljout systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" qcd_opt="--skip-QCD" shape_opt="-x mu_selVloose_ljout" & \
	make run_histos mc=${mc} data=${data_el} lumi=${lumi_el} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=el_sel_ljout systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" qcd_opt="--skip-QCD" shape_opt="-x el_selVloose_ljout" & \

# ok, conditions are not first-class in makefiles
#run_histos: sys_file=syst-test.syst-list.1
run_std_histos_no_shape: mc=distrs/distrs_v25v26resub2_mc_noqcd.root
run_std_histos_no_shape: data_mu=../quick-test/v25v26-resub2_hadds/SingleMuon.root
run_std_histos_no_shape: data_el=../quick-test/v25v26-resub2_hadds/SingleElectron.root
run_std_histos_no_shape: out=histosels/redo-v25-v26_resub2/
run_std_histos_no_shape: distr=Mt_lep_met_c
run_std_histos_no_shape: lumi_mu=35800
run_std_histos_no_shape: lumi_el=31300
run_std_histos_no_shape: wjets_norm=0.8
run_std_histos_no_shape: options=
run_std_histos_no_shape:
	# log parameters
	echo mc=${mc} data_mu=${data_mu} data_el=${data_el} lumi_mu=${lumi_mu} lumi_el=${lumi_el} distr=${distr} out=${out} wjets_norm=${wjets_norm} options=${options} > ${out}/run_std_histos.params
	# the batch with data-driven QCD
	# the qcd has the experimental systematics, but not the TT modeling
	make run_histos mc=${mc} data=${data_mu} options=${options} lumi=${lumi_mu} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=mu_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05"  & \
	make run_histos mc=${mc} data=${data_el} options=${options} lumi=${lumi_el} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=el_sel_lj    systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05"  & \
	make run_histos mc=${mc} data=${data_mu} options=${options} lumi=${lumi_mu} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=mu_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05"  & \
	make run_histos mc=${mc} data=${data_el} options=${options} lumi=${lumi_el} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=el_sel_ljout systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05"  & \
	# no updowns now
	make run_histos mc=${mc} data=${data_mu} options=${options} lumi=${lumi_mu} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=mu_sel_lj    systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`"  & \
	make run_histos mc=${mc} data=${data_el} options=${options} lumi=${lumi_el} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=el_sel_lj    systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`"  & \
	make run_histos mc=${mc} data=${data_mu} options=${options} lumi=${lumi_mu} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=mu_sel_ljout systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`"  & \
	make run_histos mc=${mc} data=${data_el} options=${options} lumi=${lumi_el} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=el_sel_ljout systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`"  & \
	#
	make run_histos mc=${mc} data=${data_mu} options=${options} lumi=${lumi_mu} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=mu_sel & \
	make run_histos mc=${mc} data=${data_el} options=${options} lumi=${lumi_el} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=el_sel & 

# ok, conditions are not first-class in makefiles
#run_histos: sys_file=syst-test.syst-list.1
run_std_histos_nocats: mc=distrs/distrs_v25v26resub2_mc_noqcd.root
run_std_histos_nocats: data_mu=../quick-test/v25v26-resub2_hadds/SingleMuon.root
run_std_histos_nocats: data_el=../quick-test/v25v26-resub2_hadds/SingleElectron.root
run_std_histos_nocats: out=histosels/redo-v25-v26_resub2/
run_std_histos_nocats: distr=Mt_lep_met_c
run_std_histos_nocats: lumi_mu=35800
run_std_histos_nocats: lumi_el=31300
run_std_histos_nocats: wjets_norm=0.8
run_std_histos_nocats: options=
run_std_histos_nocats:
	# log parameters
	echo mc=${mc} data_mu=${data_mu} data_el=${data_el} lumi_mu=${lumi_mu} lumi_el=${lumi_el} distr=${distr} out=${out} wjets_norm=${wjets_norm} options=${options} > ${out}/run_std_histos.params
	# the batch with data-driven QCD
	# the qcd has the experimental systematics, but not the TT modeling
	make run_histos mc=${mc} data=${data_mu} options=${options} lumi=${lumi_mu} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=mu_sel systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x mu_selVloose"  & \
	make run_histos mc=${mc} data=${data_el} options=${options} lumi=${lumi_el} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=el_sel systematics="NOMINAL `cat syst-test.syst-list.experimental | tr '\n' ' '`" qcd_opt="--qcd 1.05" shape_opt="-x el_selVloose"  & \
	# tt modeling with no data-driven qcd
	# no updowns now
	make run_histos mc=${mc} data=${data_mu} options=${options} lumi=${lumi_mu} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=mu_sel systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`"   shape_opt="-x mu_selVloose"  & \
	make run_histos mc=${mc} data=${data_el} options=${options} lumi=${lumi_el} distr=${distr} out=${out} wjets_norm=${wjets_norm} chan=el_sel systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`"   shape_opt="-x el_selVloose"  &

all_yields_numbers: out=histosels/v37_test13_bunch1_yields1/
all_yields_numbers:
	python numbers_for_datacard.py ${out}/full_processes/all.root -y -d yield -c mu_preselCand,mu_sel,mu_sel_lj,mu_sel_ljout --latex
	python numbers_for_datacard.py ${out}/full_processes/all.root -y -d yield -c el_preselCand,el_sel,el_sel_lj,el_sel_ljout --latex
	python numbers_for_datacard.py ${out}/all.root -y -d yield -c mu_preselCand,mu_sel,mu_sel_lj,mu_sel_ljout --latex
	python numbers_for_datacard.py ${out}/all.root -y -d yield -c el_preselCand,el_sel,el_sel_lj,el_sel_ljout --latex
	python numbers_for_datacard.py ${out}/all.root -y -d yield -c dy_elel,dy_mumu   --latex
	python numbers_for_datacard.py ${out}/all.root -y -d yield -c tt_elmu           --latex
	python numbers_for_datacard.py ${out}/all.root -y -d yield -c wjets_el,wjets_mu --latex
	python numbers_for_datacard.py ${out}/all.root -y -d yield -c dy_eltau,dy_eltau_3j,dy_mutau,dy_mutau_3j --latex

# chan=$chan qcd_opt="--qcd 1.05"
run_all_yields: mc=distrs/v37_test13_bunch1YIELDS_mc_1.root
run_all_yields: data_mu=distrs/v37_test13_bunch1YIELDS/SingleMuon.root
run_all_yields: data_el=distrs/v37_test13_bunch1YIELDS/SingleElectron.root
run_all_yields: out=histosels/v37_test13_bunch1_yields1/
run_all_yields: data_nick=data_other
run_all_yields: wjets_norm=1.4
run_all_yields: distr=yield
run_all_yields: lumi=35800
run_all_yields:
	mkdir -p ${out}/full_processes/
	# main sel
	# mu
	python stack_plot.py ${mc} ${data_mu} -o ${out} --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c mu_preselCand --qcd 1.05 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other
	python stack_plot.py ${mc} ${data_mu} -o ${out} --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c mu_sel        --qcd 1.05 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other
	python stack_plot.py ${mc} ${data_mu} -o ${out} --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c mu_sel_lj     --qcd 1.05 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other
	python stack_plot.py ${mc} ${data_mu} -o ${out} --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c mu_sel_ljout  --qcd 1.05 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other
	# el
	python stack_plot.py ${mc} ${data_el} -o ${out} --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c el_preselCand --qcd 1.05 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other
	python stack_plot.py ${mc} ${data_el} -o ${out} --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c el_sel        --qcd 1.05 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other
	python stack_plot.py ${mc} ${data_el} -o ${out} --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c el_sel_lj     --qcd 1.05 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other
	python stack_plot.py ${mc} ${data_el} -o ${out} --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c el_sel_ljout  --qcd 1.05 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other
	# also full processes for AN:
	python stack_plot.py ${mc} ${data_mu} -o ${out}/full_processes/ --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c mu_preselCand --qcd 1.05
	python stack_plot.py ${mc} ${data_mu} -o ${out}/full_processes/ --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c mu_sel        --qcd 1.05
	python stack_plot.py ${mc} ${data_mu} -o ${out}/full_processes/ --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c mu_sel_lj     --qcd 1.05
	python stack_plot.py ${mc} ${data_mu} -o ${out}/full_processes/ --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c mu_sel_ljout  --qcd 1.05
	# el
	python stack_plot.py ${mc} ${data_el} -o ${out}/full_processes/ --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c el_preselCand --qcd 1.05
	python stack_plot.py ${mc} ${data_el} -o ${out}/full_processes/ --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c el_sel        --qcd 1.05
	python stack_plot.py ${mc} ${data_el} -o ${out}/full_processes/ --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c el_sel_lj     --qcd 1.05
	python stack_plot.py ${mc} ${data_el} -o ${out}/full_processes/ --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c el_sel_ljout  --qcd 1.05
	# dy dileptons
	python stack_plot.py ${mc} ${data_mu} -o ${out} --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c dy_mumu  --qcd-factor 2.5 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_lj,tt_other:tt
	python stack_plot.py ${mc} ${data_el} -o ${out} --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c dy_elel  --qcd-factor 2.5 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_lj,tt_other:tt
	# tt elmu
	python stack_plot.py ${mc} ${data_mu} -o ${out} --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c tt_elmu  --qcd-factor 2.5 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_lj:tt_else.tt_other:tt_elmu
	# wjets
	python stack_plot.py ${mc} ${data_mu} -o ${out} --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c wjets_mu  --qcd-factor 2.5 --merge-procs dy_tautau,dy_other:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_other,tt_lj:tt
	python stack_plot.py ${mc} ${data_el} -o ${out} --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c wjets_el  --qcd-factor 2.5 --merge-procs dy_tautau,dy_other:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_other,tt_lj:tt
	# dy tautau
	python stack_plot.py ${mc} ${data_mu} -o ${out} --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c dy_mutau    --qcd 1.05 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_other,tt_lj:tt
	python stack_plot.py ${mc} ${data_mu} -o ${out} --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c dy_mutau_3j --qcd 1.05 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_other,tt_lj:tt
	python stack_plot.py ${mc} ${data_el} -o ${out} --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c dy_eltau    --qcd 1.05 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_other,tt_lj:tt
	python stack_plot.py ${mc} ${data_el} -o ${out} --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c dy_eltau_3j --qcd 1.05 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_other,tt_lj:tt
	# hadd all
	hadd -f ${out}/all.root ${out}/distr*root
	hadd -f ${out}/full_processes/all.root ${out}/full_processes/distr*root
	# produce the tables
	make all_yields_numbers out=${out}


# the missing yields, separately, the fix of missing stuff
run_all_yields_dy_tautau: mc=distrs/v37_test13_bunch1YIELDS_mc_2.root
run_all_yields_dy_tautau: data_mu=distrs/v37_test13_bunch1YIELDS/SingleMuon.root
run_all_yields_dy_tautau: data_el=distrs/v37_test13_bunch1YIELDS/SingleElectron.root
run_all_yields_dy_tautau: out=histosels/v37_test13_bunch1_yields1_dy_tautau/
run_all_yields_dy_tautau: data_nick=data_other
run_all_yields_dy_tautau: wjets_norm=1.4
run_all_yields_dy_tautau: mc_qcd_factor=2.5
run_all_yields_dy_tautau: distr=yield
run_all_yields_dy_tautau: lumi=35800
run_all_yields_dy_tautau: options=--overwrite
run_all_yields_dy_tautau:
	mkdir -p ${out}/
	# dy tautau
	# produce with mc qcd
	python stack_plot.py ${mc} ${data_mu} ${options} -o ${out} --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c dy_mutau    --qcd-factor 2.5 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_other,tt_lj:tt
	python stack_plot.py ${mc} ${data_mu} ${options} -o ${out} --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c dy_mutau_3j --qcd-factor 2.5 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_other,tt_lj:tt
	python stack_plot.py ${mc} ${data_el} ${options} -o ${out} --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c dy_eltau    --qcd-factor 2.5 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_other,tt_lj:tt
	python stack_plot.py ${mc} ${data_el} ${options} -o ${out} --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c dy_eltau_3j --qcd-factor 2.5 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_other,tt_lj:tt
	# produce with data-driven qcd
	python stack_plot.py ${mc} ${data_mu} ${options} -o ${out} --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c dy_mutau    --qcd 1.05 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_other,tt_lj:tt
	python stack_plot.py ${mc} ${data_mu} ${options} -o ${out} --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c dy_mutau_3j --qcd 1.05 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_other,tt_lj:tt
	python stack_plot.py ${mc} ${data_el} ${options} -o ${out} --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c dy_eltau    --qcd 1.05 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_other,tt_lj:tt
	python stack_plot.py ${mc} ${data_el} ${options} -o ${out} --data-nick ${data_nick} --lumi ${lumi} -d ${distr} --wjet ${wjets_norm} -c dy_eltau_3j --qcd 1.05 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_other,tt_lj:tt
	# hadd them separately all
	hadd -f ${out}/dy_tautau_yields_data-qcd.root ${out}/distr*data-qcd.root
	hadd -f ${out}/dy_tautau_yields_mc-qcd.root   ${out}/distr*NOMINAL.root
	# produce the tables
	python numbers_for_datacard.py ${out}/dy_tautau_yields_data-qcd.root -y -d yield -c dy_eltau,dy_eltau_3j,dy_mutau,dy_mutau_3j --latex
	python numbers_for_datacard.py ${out}/dy_tautau_yields_mc-qcd.root   -y -d yield -c dy_eltau,dy_eltau_3j,dy_mutau,dy_mutau_3j --latex


# all the plotting for the AN and paper

plot_control_dy_mumu: options=
plot_control_dy_mumu: merge_procs=--merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_lj,tt_other:tt
plot_control_dy_mumu:
	echo `date` plot_control_dy_mumu nt=${nt} proc=${proc} distrs=${distrs} chan=dy_mumu >> logs
	mkdir -p plots/${nt}_${proc}_${distrs}/
	# lep_pt, Mt, dilep mass
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c dy_mumu -d lep_pt         --wjet 1.4  --ratio-range 0.55 --title "" --title-x "leading muon #font[12]{p}_{T} [GeV]"             --title-y "Events"     ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c dy_mumu -d Mt_lep_met_c   --wjet 1.4  --ratio-range 0.55 --title "" --title-x "#font[12]{m}_{T}(#mu, MET) [GeV]"    --bin-norm  --title-y "Events/GeV" ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c dy_mumu -d dilep_mass_dy  --wjet 1.4  --ratio-range 0.55 --title "" --title-x "mass(#mu + #mu) [GeV]"                --title-y "Events"     ${merge_procs}

plot_control_dy_elel: options=
plot_control_dy_elel: merge_procs=--merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_lj,tt_other:tt
plot_control_dy_elel:
	echo `date` plot_control_dy_elel nt=${nt} proc=${proc} distrs=${distrs} chan=dy_elel >> logs
	mkdir -p plots/${nt}_${proc}_${distrs}/
	# lep_pt, Mt, dilep mass
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c dy_elel -d lep_pt         --wjet 1.4  --ratio-range 0.55 --title "" --title-x "leading electron #font[12]{p}_{T} [GeV]"      --title-y "Events"     ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c dy_elel -d Mt_lep_met_c   --wjet 1.4  --ratio-range 0.55 --title "" --title-x "#font[12]{m}_{T}(e, MET) [GeV]"    --bin-norm --title-y "Events/GeV" ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c dy_elel -d dilep_mass_dy  --wjet 1.4  --ratio-range 0.55 --title "" --title-x "mass(e + e) [GeV]"                 --title-y "Events"     ${merge_procs}


plot_control_dy_mutau: merge_procs=--merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_other,tt_lj:tt
plot_control_dy_mutau:
	echo `date` plot_control_dy_mutau nt=${nt} proc=${proc} distrs=${distrs} chan=dy_mutau >> logs
	mkdir -p plots/${nt}_${proc}_${distrs}/
	#
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c dy_mutau -d lep_pt         --wjet 1.4  --ratio-range 0.55 --title "" --title-x "muon #font[12]{p}_{T} [GeV]"            --title-y "Events" --qcd 1.05                  ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c dy_mutau -d lep_eta        --wjet 1.4  --ratio-range 0.55 --title "" --title-x "muon #eta [GeV]"             --title-y "Events" --qcd 1.05                  ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c dy_mutau -d tau_pt         --wjet 1.4  --ratio-range 0.55 --title "" --title-x "tau #font[12]{p}_{T} [GeV]"             --title-y "Events" --qcd 1.05                  ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c dy_mutau -d tau_eta        --wjet 1.4  --ratio-range 0.55 --title "" --title-x "tau #eta [GeV]"              --title-y "Events" --qcd 1.05                  ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c dy_mutau -d Mt_lep_met_c   --wjet 1.4  --ratio-range 0.55 --title "" --title-x "#font[12]{m}_{T}(#mu, MET) [GeV]"    --bin-norm  --title-y "Events/GeV" --qcd 1.05     ${merge_procs}
	# close to signal selection
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c dy_mutau_3j -d lep_pt         --wjet 1.4  --ratio-range 0.55 --title "" --title-x "muon #font[12]{p}_{T} [GeV]"         --title-y "Events" --qcd 1.05                  ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c dy_mutau_3j -d lep_eta        --wjet 1.4  --ratio-range 0.55 --title "" --title-x "muon #eta [GeV]"          --title-y "Events" --qcd 1.05                  ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c dy_mutau_3j -d tau_pt         --wjet 1.4  --ratio-range 0.55 --title "" --title-x "tau #font[12]{p}_{T} [GeV]"          --title-y "Events" --qcd 1.05                  ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c dy_mutau_3j -d tau_eta        --wjet 1.4  --ratio-range 0.55 --title "" --title-x "tau #eta [GeV]"           --title-y "Events" --qcd 1.05                  ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c dy_mutau_3j -d Mt_lep_met_c   --wjet 1.4  --ratio-range 0.55 --title "" --title-x "#font[12]{m}_{T}(#mu, MET) [GeV]"    --bin-norm  --title-y "Events/GeV" --qcd 1.05  ${merge_procs}

plot_control_dy_eltau: merge_procs=--merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_other,tt_lj:tt
plot_control_dy_eltau:
	echo `date` plot_control_dy_eltau nt=${nt} proc=${proc} distrs=${distrs} chan=dy_eltau >> logs
	mkdir -p plots/${nt}_${proc}_${distrs}/
	#
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c dy_eltau -d lep_pt         --wjet 1.4  --ratio-range 0.55 --title "" --title-x "electron #font[12]{p}_{T} [GeV]"            --title-y "Events" --qcd 1.05                 ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c dy_eltau -d lep_eta        --wjet 1.4  --ratio-range 0.55 --title "" --title-x "electron #eta [GeV]"             --title-y "Events" --qcd 1.05                 ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c dy_eltau -d tau_pt         --wjet 1.4  --ratio-range 0.55 --title "" --title-x "tau #font[12]{p}_{T} [GeV]"             --title-y "Events" --qcd 1.05                 ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c dy_eltau -d tau_eta        --wjet 1.4  --ratio-range 0.55 --title "" --title-x "tau #eta [GeV]"              --title-y "Events" --qcd 1.05                 ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c dy_eltau -d Mt_lep_met_c   --wjet 1.4  --ratio-range 0.55 --title "" --title-x "#font[12]{m}_{T}(e, MET) [GeV]"    --bin-norm  --title-y "Events/GeV" --qcd 1.05    ${merge_procs}
	# close to signal selection
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c dy_eltau_3j -d lep_pt         --wjet 1.4  --ratio-range 0.55 --title "" --title-x "electron #font[12]{p}_{T} [GeV]"             --title-y "Events" --qcd 1.05             ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c dy_eltau_3j -d lep_eta        --wjet 1.4  --ratio-range 0.55 --title "" --title-x "electron #eta [GeV]"              --title-y "Events" --qcd 1.05             ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c dy_eltau_3j -d tau_pt         --wjet 1.4  --ratio-range 0.55 --title "" --title-x "tau #font[12]{p}_{T} [GeV]"              --title-y "Events" --qcd 1.05             ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c dy_eltau_3j -d tau_eta        --wjet 1.4  --ratio-range 0.55 --title "" --title-x "tau #eta [GeV]"               --title-y "Events" --qcd 1.05             ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c dy_eltau_3j -d Mt_lep_met_c   --wjet 1.4  --ratio-range 0.55 --title "" --title-x "#font[12]{m}_{T}(e, MET) [GeV]"    --bin-norm  --title-y "Events/GeV" --qcd 1.05 ${merge_procs}

plot_control_wjets_mu: options=
plot_control_wjets_mu: merge_procs=--merge-procs dy_tautau,dy_other:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_other,tt_lj:tt
plot_control_wjets_mu:
	echo `date` plot_control_wjets_mu nt=${nt} proc=${proc} distrs=${distrs} chan=wjets_mu >> logs
	mkdir -p plots/${nt}_${proc}_${distrs}/
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root ${options} -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c wjets_mu -d lep_pt         --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55 --title "" --title-x "leading muon #font[12]{p}_{T} [GeV]"            --title-y "Events"                ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root ${options} -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c wjets_mu -d lep_pt         --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55 --title "" --title-x "leading muon #font[12]{p}_{T} [GeV]"            --title-y "Events" --qcd 1.05     ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root ${options} -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c wjets_mu -d Mt_lep_met_c   --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55 --title "" --title-x "#font[12]{m}_{T}(#mu, MET) [GeV]"    --bin-norm --title-y "Events/GeV"            ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root ${options} -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c wjets_mu -d Mt_lep_met_c   --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55 --title "" --title-x "#font[12]{m}_{T}(#mu, MET) [GeV]"    --bin-norm --title-y "Events/GeV" --qcd 1.05 ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root ${options} -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c wjets_mu -d met_c   --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55 --title "" --title-x "MET [GeV]"    --bin-norm --title-y "Events/GeV"            ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root ${options} -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c wjets_mu -d met_c   --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55 --title "" --title-x "MET [GeV]"    --bin-norm --title-y "Events/GeV" --qcd 1.05 ${merge_procs}

plot_control_wjets_el: options=
plot_control_wjets_el: merge_procs=--merge-procs dy_tautau,dy_other:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_other,tt_lj:tt
plot_control_wjets_el:
	echo `date` plot_control_wjets_el nt=${nt} proc=${proc} distrs=${distrs} chan=wjets_el >> logs
	mkdir -p plots/${nt}_${proc}_${distrs}/
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root ${options} -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c wjets_el -d lep_pt         --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55 --title "" --title-x "leading electron #font[12]{p}_{T} [GeV]"      --title-y "Events"                  ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root ${options} -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c wjets_el -d lep_pt         --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55 --title "" --title-x "leading electron #font[12]{p}_{T} [GeV]"      --title-y "Events" --qcd 1.05       ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root ${options} -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c wjets_el -d Mt_lep_met_c   --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55 --title "" --title-x "#font[12]{m}_{T}(e, MET) [GeV]"    --bin-norm --title-y "Events/GeV"              ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root ${options} -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c wjets_el -d Mt_lep_met_c   --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55 --title "" --title-x "#font[12]{m}_{T}(e, MET) [GeV]"    --bin-norm --title-y "Events/GeV" --qcd 1.05   ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root ${options} -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c wjets_el -d met_c   --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55 --title "" --title-x "MET [GeV]"    --bin-norm --title-y "Events/GeV"              ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root ${options} -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c wjets_el -d met_c   --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55 --title "" --title-x "MET [GeV]"    --bin-norm --title-y "Events/GeV" --qcd 1.05   ${merge_procs}

# special wjets with amcatnlo
plot_control_wjets_amcatnlo: merge_procs=--merge-procs dy_tautau,dy_other:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_other,tt_lj:tt
plot_control_wjets_amcatnlo:
	echo `date` plot_control_wjets_amcatnlo nt=${nt} proc=${proc} distrs=${distrs} chan=wjets_el wjets_mu >> logs
	mkdir -p plots/${nt}_${proc}_${distrs}/
	#
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc_wjetsamcatnlo.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} -c wjets_mu -d lep_pt         --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55 --title "" --title-x "leading muon #font[12]{p}_{T} [GeV]"            --title-y "Events"     ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc_wjetsamcatnlo.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} -c wjets_mu -d Mt_lep_met_c   --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55 --title "" --title-x "#font[12]{m}_{T}(#mu, MET) [GeV]"    --bin-norm --title-y "Events/GeV" ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc_wjetsamcatnlo.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} -c wjets_el -d lep_pt         --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55 --title "" --title-x "leading electron #font[12]{p}_{T} [GeV]"      --title-y "Events"       ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc_wjetsamcatnlo.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} -c wjets_el -d Mt_lep_met_c   --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55 --title "" --title-x "#font[12]{m}_{T}(e, MET) [GeV]"    --bin-norm --title-y "Events/GeV"   ${merge_procs}


plot_lj_1: chan_tag=mu
plot_lj_1: mW=80.385
plot_lj_1: mt=172.5
plot_lj_1: options=
plot_lj_1: merge_procs=
plot_lj_1:
	echo `date` plot_lj_1 nt=${nt} proc=${proc} distrs=${distrs} >> logs
	mkdir -p plots/${nt}_${proc}_${distrs}/
	## Comparison qcd data-driven VS MC in wjets and presel control regions
	## wjets
	#python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} -c ${chan_tag}_wjets -d Mt_lep_met_c --wjet 1.4 --qcd        1.05 --ratio-range 0.55 --bin-norm --title "" --title-x "#font[12]{m}_{T}(${title_lep}, MET) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02
	#python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} -c ${chan_tag}_wjets -d Mt_lep_met_c --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55 --bin-norm --title "" --title-x "#font[12]{m}_{T}(${title_lep}, MET) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02
	#python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} -c ${chan_tag}_wjets -d lep_pt --wjet 1.4 --qcd        1.05 --ratio-range 0.55                  --title "" --title-x "lepton #font[12]{p}_{T} [GeV]" --title-y "Events" --draw-overflows 5 --legend-shift 0.02
	#python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} -c ${chan_tag}_wjets -d lep_pt --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55                  --title "" --title-x "lepton #font[12]{p}_{T} [GeV]" --title-y "Events" --draw-overflows 5 --legend-shift 0.02
	#python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} -c ${chan_tag}_wjets -d met_f --wjet 1.4 --qcd        1.05 --ratio-range 0.55       --bin-norm --title "" --title-x "#font[12]{p}^{miss}_{T} [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02
	#python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} -c ${chan_tag}_wjets -d met_f --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55       --bin-norm --title "" --title-x "#font[12]{p}^{miss}_{T} [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02
	# presel
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c ${chan_tag}_preselCand -d Mt_lep_met_f --wjet 1.4 --qcd        1.05 --ratio-range 0.55 --bin-norm --title "" --title-x "#font[12]{m}_{T}(${title_lep}, MET) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02  ${options} ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c ${chan_tag}_preselCand -d Mt_lep_met_f --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55 --bin-norm --title "" --title-x "#font[12]{m}_{T}(${title_lep}, MET) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02  ${options} ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c ${chan_tag}_preselCand -d lep_pt --wjet 1.4 --qcd        1.05 --ratio-range 0.55                  --title "" --title-x "lepton #font[12]{p}_{T} [GeV]" --title-y "Events" --draw-overflows 5 --legend-shift 0.02                    ${options} ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c ${chan_tag}_preselCand -d lep_pt --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55                  --title "" --title-x "lepton #font[12]{p}_{T} [GeV]" --title-y "Events" --draw-overflows 5 --legend-shift 0.02                    ${options} ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c ${chan_tag}_preselCand -d met_c --wjet 1.4 --qcd        1.05 --ratio-range 0.55       --bin-norm --title "" --title-x "#font[12]{p}^{miss}_{T} [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02                 ${options} ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c ${chan_tag}_preselCand -d met_c --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55       --bin-norm --title "" --title-x "#font[12]{p}^{miss}_{T} [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02                 ${options} ${merge_procs}
	# lj parameters, with MC and data-driven QCD
	#python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c ${chan_tag}_preselCand -d dijet_mass        --wjet 1.4 --qcd        1.05 --ratio-range 0.55       --bin-norm --title "" --title-x  "di-jet mass [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02
	#python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c ${chan_tag}_preselCand -d trijet_mass       --wjet 1.4 --qcd        1.05 --ratio-range 0.55       --bin-norm --title "" --title-x "tri-jet mass [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02
	#python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c ${chan_tag}_preselCand -d dijet_trijet_mass --wjet 1.4 --qcd        1.05 --ratio-range 0.55       --bin-norm --title "" --title-x "#sqrt{(m_{2j} - ${mW})^{2} + (m_{3j} - ${mt})^{2}} [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02
	#python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c ${chan_tag}_preselCand -d dijet_mass        --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55       --bin-norm --title "" --title-x  "di-jet mass [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02
	#python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c ${chan_tag}_preselCand -d trijet_mass       --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55       --bin-norm --title "" --title-x "tri-jet mass [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02
	#python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c ${chan_tag}_preselCand -d dijet_trijet_mass --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55       --bin-norm --title "" --title-x "#sqrt{(m_{2j} - ${mW})^{2} + (m_{3j} - ${mt})^{2}} [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02
	# these were not saved in presel!

# TOFIX: correct ttbar processes in tt_elmu
#plot_tt_dilep: merge_procs=--merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_lj:tt_else.tt_other:tt_elmu
plot_tt_dilep: options=
plot_tt_dilep: merge_procs=--merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_lj,tt_other:tt
plot_tt_dilep:
	echo `date` plot_tt_dilep nt=${nt} proc=${proc} distrs=${distrs} >> logs
	mkdir -p plots/${nt}_${proc}_${distrs}/
	# plots for control of the shapes of single-top and dibosons
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c tt_elmu -d Mt_lep_met_c --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55 --bin-norm --title "" --title-x "#font[12]{m}_{T} [GeV]"                --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02    ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c tt_elmu -d lep_pt       --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55            --title "" --title-x "leading lepton #font[12]{p}_{T} [GeV]" --title-y "Events"     --draw-overflows 5 --legend-shift 0.02    ${merge_procs}  --no-horizontal-error-bars
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c tt_elmu -d met_c        --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55 --bin-norm --title "" --title-x "#font[12]{p}^{miss}_{T} [GeV]"         --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02    ${merge_procs}
	#
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c tt_elmu -d Mt_lep_met_c --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55 --bin-norm --title "" --title-x "#font[12]{m}_{T} [GeV]"                --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --sys TOPPTUp    ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c tt_elmu -d lep_pt       --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55            --title "" --title-x "leading lepton #font[12]{p}_{T} [GeV]" --title-y "Events"     --draw-overflows 5 --legend-shift 0.02 --sys TOPPTUp    ${merge_procs}  --no-horizontal-error-bars
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c tt_elmu -d met_c        --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55 --bin-norm --title "" --title-x "#font[12]{p}^{miss}_{T} [GeV]"         --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --sys TOPPTUp    ${merge_procs}

plot_tt_dilep_mu: datafile=SingleMuon
plot_tt_dilep_mu: lumi=35800
plot_tt_dilep_mu: plot_tt_dilep


#plot_sel_1: nt=v25v26
#plot_sel_1: proc=redo
#plot_sel_1: distrs=4
#plot_sel_1: lumi=31300
#plot_sel_1: datafile=SingleElectron
#plot_sel_1: chan_tag=el
#plot_sel_1: title_lep=e

plot_presel_1: presel_lev=
plot_presel_1: options=
plot_presel_1: merge_procs=
plot_presel_1:
	echo `date` plot_presel_1 nt=${nt} proc=${proc} distrs=${distrs} chan=${chan_tag}_presel${presel_lev} >> logs
	mkdir -p plots/${nt}_${proc}_${distrs}/
	# main preselection
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} ${options} --data-nick data_other -c ${chan_tag}_presel${presel_lev}      -d lep_pt  --wjet 1.4 --qcd 1.05 --ratio-range 0.55 --bin-norm --title "" --title-x "${title_lep} #font[12]{p}_{T} [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02               ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} ${options} --data-nick data_other -c ${chan_tag}_presel${presel_lev}      -d lep_eta --wjet 1.4 --qcd 1.05 --ratio-range 0.55            --title "" --title-x "${title_lep} #eta" --title-y "Events"                                                                            ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} ${options} --data-nick data_other -c ${chan_tag}_presel${presel_lev}      -d tau_pt  --wjet 1.4 --qcd 1.05 --ratio-range 0.55 --bin-norm --title "" --title-x "#tau #font[12]{p}_{T} [GeV]"  --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02                      ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} ${options} --data-nick data_other -c ${chan_tag}_presel${presel_lev}      -d tau_eta --wjet 1.4 --qcd 1.05 --ratio-range 0.55            --title "" --title-x "#tau #eta"         --title-y "Events"                                                                            ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} ${options} --data-nick data_other -c ${chan_tag}_presel${presel_lev}      -d bjet_pt  --wjet 1.4 --qcd 1.05 --ratio-range 0.55 --bin-norm --title "" --title-x "leading b-tagged jet #font[12]{p}_{T} [GeV]"    --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02   ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} ${options} --data-nick data_other -c ${chan_tag}_presel${presel_lev}      -d bjet_eta --wjet 1.4 --qcd 1.05 --ratio-range 0.55            --title "" --title-x "leading b-tagged jet #eta"        --title-y "Events"                                                            ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} ${options} --data-nick data_other -c ${chan_tag}_presel${presel_lev}      -d Mt_lep_met_f --wjet 1.4 --qcd 1.05 --ratio-range 0.55 --bin-norm --title "" --title-x "#font[12]{m}_{T}(${symbol_lep}, MET) [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02   ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} ${options} --data-nick data_other -c ${chan_tag}_presel${presel_lev}      -d met_c   --wjet 1.4 --qcd 1.05 --ratio-range 0.55 --bin-norm --title "" --title-x "MET [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02                             ${merge_procs}
	# couple examples of top pt systematic${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} ${options} --data-nick data_other -c ${chan_tag}_presel${presel_lev}      -d met_c   --wjet 1.4 --qcd 1.05 --ratio-range 0.55 --bin-norm --title "" --title-x "MET [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02  --sys TOPPTUp              ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} ${options} --data-nick data_other -c ${chan_tag}_presel${presel_lev}      -d lep_pt  --wjet 1.4 --qcd 1.05 --ratio-range 0.55 --bin-norm --title "" --title-x "${title_lep} #font[12]{p}_{T} [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02 --sys TOPPTUp ${merge_procs}

plot_presel_mc_qcd: presel_lev=
plot_presel_mc_qcd: options=
plot_presel_mc_qcd:
	echo `date` plot_presel_mc_qcd nt=${nt} proc=${proc} distrs=${distrs} chan=${chan_tag}_presel${presel_lev} >> logs
	mkdir -p plots/${nt}_${proc}_${distrs}/
	#
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} ${options} --data-nick data_other -c ${chan_tag}_presel${presel_lev}      -d Mt_lep_met_f --wjet 1.4 --qcd-factor 2.5 --ratio-range 0.55 --bin-norm --title "" --title-x "#font[12]{m}_{T}(${title_lep}, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02
	#python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} ${options} --data-nick data_other -c ${chan_tag}_presel${presel_lev}      -d met_f        --wjet 1.4 --qcd-factor 2.5 --ratio-range 0.55 --bin-norm --title "" --title-x "MET [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} ${options} --data-nick data_other -c ${chan_tag}_presel${presel_lev}      -d lep_pt       --wjet 1.4 --qcd-factor 2.5 --ratio-range 0.55 --bin-norm --title "" --title-x "${title_lep} #font[12]{p}_{T} [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02
	# TOPPT
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} ${options} --data-nick data_other -c ${chan_tag}_presel${presel_lev}      -d Mt_lep_met_f --wjet 1.4 --qcd-factor 2.5 --ratio-range 0.55 --bin-norm --title "" --title-x "#font[12]{m}_{T}(${title_lep}, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02 --sys TOPPTUp
	#python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} ${options} --data-nick data_other -c ${chan_tag}_presel${presel_lev}      -d met_f        --wjet 1.4 --qcd-factor 2.5 --ratio-range 0.55 --bin-norm --title "" --title-x "MET [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02  --sys TOPPTUp
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} ${options} --data-nick data_other -c ${chan_tag}_presel${presel_lev}      -d lep_pt       --wjet 1.4 --qcd-factor 2.5 --ratio-range 0.55 --bin-norm --title "" --title-x "${title_lep} #font[12]{p}_{T} [GeV]" --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02  --sys TOPPTUp


# TODO: add the presel lj parameters, 2-j and 3-j masses, with Data and MC QCD
plot_presel_lj_1: presel_lev=
plot_presel_lj_1: the_distr=Mt_lep_met_f
plot_presel_lj_1:
	echo `date` plot_presel_lj_1 nt=${nt} proc=${proc} distrs=${distrs} chan=${chan_tag}_presel${presel_lev} lj-ljout ${the_distr} >> logs
	mkdir -p plots/${nt}_${proc}_${distrs}/
	# event categories pre-fit plots
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} -c ${chan_tag}_presel${presel_lev}_ljout -d ${the_distr} --wjet 1.4 --qcd 1.05 --ratio-range 0.55 --bin-norm --title "" --title-x "#font[12]{m}_{T}(${title_lep}, MET) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} -c ${chan_tag}_presel${presel_lev}_lj    -d ${the_distr} --wjet 1.4 --qcd 1.05 --ratio-range 0.55 --bin-norm --title "" --title-x "#font[12]{m}_{T}(${title_lep}, MET) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02


# the prefit Mt distrs in categories
plot_sel_lj_1: the_distr=Mt_lep_met_f
plot_sel_lj_1:
	echo `date` plot_sel_lj_1 pre-fit nt=${nt} proc=${proc} distrs=${distrs} chan=${chan_tag}_sel lj-ljout ${the_distr} >> logs
	mkdir -p plots/${nt}_${proc}_${distrs}/
	# event categories pre-fit plots
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} -c ${chan_tag}_sel_ljout -x ${chan_tag}_selVloose_ljout -d Mt_lep_met_c --wjet 1.4 --qcd 1.05 --ratio-range 0.55 --bin-norm --title "" --title-x "#font[12]{m}_{T}(${title_lep}, MET) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} -c ${chan_tag}_sel_lj    -x ${chan_tag}_selVloose_lj    -d Mt_lep_met_c --wjet 1.4 --qcd 1.05 --ratio-range 0.55 --bin-norm --title "" --title-x "#font[12]{m}_{T}(${title_lep}, MET) [GeV]"   --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02



# main selection plots without categories
plot_sel_1: options=--data-nick data_other --overwrite
plot_sel_1: merge_procs=
plot_sel_1: output_type=png
plot_sel_1:
	echo `date` plot_sel_1 nt=${nt} proc=${proc} distrs=${distrs} chan=${chan_tag}_sel merge_procs=${merge_procs} >> logs
	mkdir -p plots/${nt}_${proc}_${distrs}/
	# main selection
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root --output-type ${output_type} -o plots/${nt}_${proc}_${distrs}/ ${options} ${merge_procs} -p -r --lumi ${lumi} -c ${chan_tag}_sel    -x ${chan_tag}_selVloose    -d lep_pt  --wjet 1.4 --qcd 1.05             --title "" --title-x "${title_lep} #font[12]{p}_{T} [GeV]" --title-y "Events" --draw-overflows 5 --legend-shift 0.02
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root --output-type ${output_type} -o plots/${nt}_${proc}_${distrs}/ ${options} ${merge_procs} -p -r --lumi ${lumi} -c ${chan_tag}_sel    -x ${chan_tag}_selVloose    -d lep_eta --wjet 1.4 --qcd 1.05             --title "" --title-x "${title_lep} #eta" --title-y "Events"
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root --output-type ${output_type} -o plots/${nt}_${proc}_${distrs}/ ${options} ${merge_procs} -p -r --lumi ${lumi} -c ${chan_tag}_sel    -x ${chan_tag}_selVloose    -d tau_pt  --wjet 1.4 --qcd 1.05             --title "" --title-x "#tau #font[12]{p}_{T} [GeV]"  --title-y "Events" --draw-overflows 5 --legend-shift 0.02
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root --output-type ${output_type} -o plots/${nt}_${proc}_${distrs}/ ${options} ${merge_procs} -p -r --lumi ${lumi} -c ${chan_tag}_sel    -x ${chan_tag}_selVloose    -d tau_eta --wjet 1.4 --qcd 1.05             --title "" --title-x "#tau #eta"         --title-y "Events"
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root --output-type ${output_type} -o plots/${nt}_${proc}_${distrs}/ ${options} ${merge_procs} -p -r --lumi ${lumi} -c ${chan_tag}_sel                                -d bjet_pt --wjet 1.4 --qcd 1.05             --title "" --title-x "leading b-tagged jet #font[12]{p}_{T} [GeV]" --title-y "Events" --draw-overflows 5 --legend-shift 0.02
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root --output-type ${output_type} -o plots/${nt}_${proc}_${distrs}/ ${options} ${merge_procs} -p -r --lumi ${lumi} -c ${chan_tag}_sel                                -d bjet_eta --wjet 1.4 --qcd 1.05            --title "" --title-x "leading b-tagged jet #eta"            --title-y "Events"
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root --output-type ${output_type} -o plots/${nt}_${proc}_${distrs}/ ${options} ${merge_procs} -p -r --lumi ${lumi} -c ${chan_tag}_sel                                -d rjet_lead_pt  --wjet 1.4 --qcd 1.05       --title "" --title-x "leading non b-tagged jet #font[12]{p}_{T} [GeV]" --title-y "Events" --draw-overflows 5 --legend-shift 0.02
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root --output-type ${output_type} -o plots/${nt}_${proc}_${distrs}/ ${options} ${merge_procs} -p -r --lumi ${lumi} -c ${chan_tag}_sel                                -d rjet_lead_eta --wjet 1.4 --qcd 1.05       --title "" --title-x "leading non b-tagged jet #eta"        --title-y "Events"
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root --output-type ${output_type} -o plots/${nt}_${proc}_${distrs}/ ${options} ${merge_procs} -p -r --lumi ${lumi} -c ${chan_tag}_sel    -x ${chan_tag}_selVloose    -d Mt_lep_met_f --wjet 1.4 --qcd 1.05        --title "" --title-x "#font[12]{m}_{T}(${title_lep}, p^{miss}_{T}) [GeV]"       --title-y "Events"     --draw-overflows 5 --legend-shift 0.02
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root --output-type ${output_type} -o plots/${nt}_${proc}_${distrs}/ ${options} ${merge_procs} -p -r --lumi ${lumi} -c ${chan_tag}_sel    -x ${chan_tag}_selVloose    -d Mt_lep_met_c --wjet 1.4 --qcd 1.05 --bin-norm  --title "" --title-x "#font[12]{m}_{T}(${title_lep}, p^{miss}_{T}) [GeV]"  --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root --output-type ${output_type} -o plots/${nt}_${proc}_${distrs}/ ${options} ${merge_procs} -p -r --lumi ${lumi} -c ${chan_tag}_sel    -x ${chan_tag}_selVloose    -d met_c      --wjet 1.4 --qcd 1.05   --bin-norm  --title "" --title-x "p^{miss}_{T} [GeV]"         --title-y "Events/GeV" --draw-overflows 5 --legend-shift 0.02
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root --output-type ${output_type} -o plots/${nt}_${proc}_${distrs}/ ${options} ${merge_procs} -p -r --lumi ${lumi} -c ${chan_tag}_sel    -x ${chan_tag}_selVloose    -d met_f      --wjet 1.4 --qcd 1.05               --title "" --title-x "p^{miss}_{T} [GeV]"         --title-y "Events"     --draw-overflows 5 --legend-shift 0.02
	# N jets
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root --output-type ${output_type} -o plots/${nt}_${proc}_${distrs}/ ${options} ${merge_procs} -p -r --lumi ${lumi} -c ${chan_tag}_sel                                -d nbjets     --wjet 1.4 --qcd 1.05          --title "" --title-x "number of b-tagged jets"         --title-y "Events"
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root --output-type ${output_type} -o plots/${nt}_${proc}_${distrs}/ ${options} ${merge_procs} -p -r --lumi ${lumi} -c ${chan_tag}_sel                                -d nrjets     --wjet 1.4 --qcd 1.05          --title "" --title-x "number of not b-tagged jets"     --title-y "Events"
	# more
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root --output-type ${output_type} -o plots/${nt}_${proc}_${distrs}/ ${options} ${merge_procs} -p -r --lumi ${lumi} -c ${chan_tag}_sel    -x ${chan_tag}_selVloose    -d dilep_mass --wjet 1.4 --qcd 1.05          --title "" --title-x "mass(l+#tau_{h}) [GeV]"           --title-y "Events"
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root --output-type ${output_type} -o plots/${nt}_${proc}_${distrs}/ ${options} ${merge_procs} -p -r --lumi ${lumi} -c ${chan_tag}_sel                                -d phi_met_lep     --wjet 1.4 --qcd 1.05     --title "" --title-x "#delta#phi(l, p^{miss}_{T})"      --title-y "Events"
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root --output-type ${output_type} -o plots/${nt}_${proc}_${distrs}/ ${options} ${merge_procs} -p -r --lumi ${lumi} -c ${chan_tag}_sel                                -d cos_phi_met_lep --wjet 1.4 --qcd 1.05     --title "" --title-x "cos(#Delta#phi(l, p^{miss}_{T}))" --title-y "Events"


# in paper, with merged processes, main selection plots without categories and 
plot_sel_paper_1: options=--data-nick data_other --overwrite
plot_sel_paper_1: merge_procs=
plot_sel_paper_1: y_range=--y-range 0,250.
plot_sel_paper_1: symbol_lep=l
plot_sel_paper_1:
	echo `date` plot_sel_paper_1 nt=${nt} proc=${proc} distrs=${distrs} chan=${chan_tag}_sel >> logs
	mkdir -p plots/${nt}_${proc}_${distrs}/paper/
	#
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/paper/ ${options} -p -r --lumi ${lumi} -c ${chan_tag}_sel    -x ${chan_tag}_selVloose    -d Mt_lep_met_c --wjet 1.4 --qcd 1.05 --ratio-range 0.55 --bin-norm --title "" --title-x "#font[12]{m}_{T}(${symbol_lep}, MET) [GeV]"         --title-y "Events/GeV"     --draw-overflows 5 --legend-shift 0.02  ${merge_procs} ${y_range}


plot_sel_2: options=--data-nick data_other --overwrite
plot_sel_2: merge_procs=--merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other
plot_sel_2:
	echo `date` plot_sel_2 nt=${nt} proc=${proc} distrs=${distrs} chan=${chan_tag}_sel >> logs
	mkdir -p plots/${nt}_${proc}_${distrs}/
	# N jets
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} -c ${chan_tag}_sel    -x ${chan_tag}_selVloose    -d nbjets      --wjet 1.4 --qcd 1.05 --ratio-range 0.55 --title "" --title-x "N b-tagged jets"      --title-y "Events"  ${options}  ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} -c ${chan_tag}_sel    -x ${chan_tag}_selVloose    -d nrjets      --wjet 1.4 --qcd 1.05 --ratio-range 0.55 --title "" --title-x "N not b-tagged jets"  --title-y "Events"  ${options}  ${merge_procs}
	# N vertices
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} -c ${chan_tag}_sel    -x ${chan_tag}_selVloose    -d nvtx      --wjet 1.4 --qcd 1.05 --ratio-range 0.55 --title "Nominal" --title-x "N reco vertices"  --title-y "Events"                         ${options}  ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} -c ${chan_tag}_sel    -x ${chan_tag}_selVloose    -d nvtx      --wjet 1.4 --qcd 1.05 --ratio-range 0.55 --title "PU Up"   --title-x "N reco vertices"  --title-y "Events" --systematic PUUp       ${options}  ${merge_procs}
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} -c ${chan_tag}_sel    -x ${chan_tag}_selVloose    -d nvtx      --wjet 1.4 --qcd 1.05 --ratio-range 0.55 --title "PU Down" --title-x "N reco vertices"  --title-y "Events" --systematic PUDown     ${options}  ${merge_procs}



plot_sel_mt_1:
	echo `date` plot_sel_mt_1 nt=${nt} proc=${proc} distrs=${distrs} chan=${chan_tag}_sel >> logs
	mkdir -p plots/${nt}_${proc}_${distrs}/
	# Mt investigation
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} -c ${chan_tag}_sel    -x ${chan_tag}_selVloose    -d cos_phi_met_lep  --wjet 1.4 --qcd 1.05 --ratio-range 0.55 --title "" --title-x "cos(${title_lep}, MET)"         --title-y "Events"
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} -c ${chan_tag}_sel    -x ${chan_tag}_selVloose    -d phi_met_lep      --wjet 1.4 --qcd 1.05 --ratio-range 0.55 --title "" --title-x "#phi(${title_lep}, MET)"        --title-y "Events"


plot_sel_fit_1: options=
plot_sel_fit_1: merge_procs=
plot_sel_fit_1: symbol_lep=l
plot_sel_fit_1:
	echo `date` plot_sel_fit_1 nt=${nt} proc=${proc} distrs=${distrs} chan=${chan_tag}_sel >> logs
	mkdir -p plots/${nt}_${proc}_${distrs}/
	# Mt in all categories from the main selection
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} ${merge_procs} -p -r --lumi ${lumi} -c ${chan_tag}_sel       -x ${chan_tag}_selVloose       -d Mt_lep_met_c  --wjet 1.4 --qcd 1.05 --ratio-range 0.55 --title "" --title-x "#font[12]{m}_{T}(${symbol_lep}, #font[12]{p}^{miss}_{T}) [GeV]"   --bin-norm      --title-y "Events/GeV"
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} ${merge_procs} -p -r --lumi ${lumi} -c ${chan_tag}_sel_lj    -x ${chan_tag}_selVloose_lj    -d Mt_lep_met_c  --wjet 1.4 --qcd 1.05 --ratio-range 0.55 --title "" --title-x "#font[12]{m}_{T}(${symbol_lep}, #font[12]{p}^{miss}_{T}) [GeV]"   --bin-norm      --title-y "Events/GeV" --label "Background-like" --label-offset 0.28
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} ${merge_procs} -p -r --lumi ${lumi} -c ${chan_tag}_sel_ljout -x ${chan_tag}_selVloose_ljout -d Mt_lep_met_c  --wjet 1.4 --qcd 1.05 --ratio-range 0.55 --title "" --title-x "#font[12]{m}_{T}(${symbol_lep}, #font[12]{p}^{miss}_{T}) [GeV]"   --bin-norm      --title-y "Events/GeV" --label "Signal-like"     --label-offset 0.3


plot_sel_std_1_mu: nt=v25v26
plot_sel_std_1_mu: proc=redo
plot_sel_std_1_mu: distrs=4
plot_sel_std_1_mu: lumi=35800
plot_sel_std_1_mu: datafile=SingleMuon
plot_sel_std_1_mu: chan_tag=mu
plot_sel_std_1_mu: title_lep=#mu
plot_sel_std_1_mu: plot_sel_1 plot_sel_lj_1

plot_sel_std_1_el: nt=v25v26
plot_sel_std_1_el: proc=redo
plot_sel_std_1_el: distrs=4
plot_sel_std_1_el: lumi=31300
plot_sel_std_1_el: datafile=SingleElectron
plot_sel_std_1_el: chan_tag=el
plot_sel_std_1_el: title_lep=e
plot_sel_std_1_el: plot_sel_1 plot_sel_lj_1

# this does not work on its own with defaults and dependencies
# # it runs only 1 dependency
# hence the explicit re-make
plot_sel: nt=v25v26
plot_sel: proc=redo
plot_sel: distrs=4
plot_sel:
	make plot_sel_std_1_mu nt=${nt} proc=${proc} distrs=${distrs}
	make plot_sel_std_1_el nt=${nt} proc=${proc} distrs=${distrs}


plot_control_met: distr=met_f
plot_control_met: options=
plot_control_met: y_title=Events
plot_control_met: chan_tag=mu
plot_control_met:
	echo `date` plot_control_met nt=${nt} proc=${proc} distrs=${distrs} chan=${chan_tag} >> logs
	mkdir -p plots/${nt}_${proc}_${distrs}/
	# main selection
	#python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} -c ${chan_tag}_sel    -x ${chan_tag}_selVloose    -d ${distr}      --wjet 1.4 --qcd 1.05 --ratio-range 0.55 ${options} --title "" --title-x "#font[12]{p}^{miss}_{T} [GeV]"         --title-y "${y_title}"     --draw-overflows 5 --legend-shift 0.02 --data-nick data_other
	# forgot the shapes
	#python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} -c ${chan_tag}_sel    -d ${distr}      --wjet 1.4 --qcd 1.05 --ratio-range 0.55  --title "" --title-x "#font[12]{p}^{miss}_{T} [GeV]"         --title-y "${y_title}"     --draw-overflows 5 --legend-shift 0.02 --data-nick data_other
	#python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} -c ${chan_tag}_sel    -d ${distr}      --wjet 1.4 --qcd 1.05 --ratio-range 0.55  --title "" --title-x "#font[12]{p}^{miss}_{T} [GeV]"         --title-y "${y_title}"     --draw-overflows 5 --legend-shift 0.02 --data-nick data_other --sys TOPPTUp
	# wjets
	# data-driven and MC qcd
	#python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root ${options} -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c wjets_${chan_tag} -d ${distr}   --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55 --title "" --title-x "#font[12]{p}^{miss}_{T} [GeV]"     --title-y "${y_title}"            ${merge_procs} --merge-procs dy_tautau,dy_other:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_other,tt_lj:tt
	#python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root ${options} -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c wjets_${chan_tag} -d ${distr}   --wjet 1.4 --qcd        1.05 --ratio-range 0.55 --title "" --title-x "#font[12]{p}^{miss}_{T} [GeV]"     --title-y "${y_title}"            ${merge_procs} --merge-procs dy_tautau,dy_other:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_other,tt_lj:tt
	# tt elmu
	# with TOPPT
	#python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c tt_elmu -d ${distr}       --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55  --title "" --title-x "#font[12]{p}^{miss}_{T} [GeV]" --title-y "${y_title}" --draw-overflows 5 --legend-shift 0.02                --sys TOPPTUp    ${merge_procs}  --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_lj,tt_other:tt
	#python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ ${options} -p -r --lumi ${lumi} --data-nick data_other -c tt_elmu -d ${distr}       --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55  --title "" --title-x "#font[12]{p}^{miss}_{T} [GeV]" --title-y "${y_title}" --draw-overflows 5 --legend-shift 0.02                                 ${merge_procs}  --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_lj,tt_other:tt
	# presel
	# data-driven and MC QCD
	# with TOPPT
	#python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c ${chan_tag}_preselCand -d ${distr} --wjet 1.4 --qcd        1.05 --ratio-range 0.55  ${options} --title "" --title-x "#font[12]{p}^{miss}_{T} [GeV]" --title-y "${y_title}" --draw-overflows 5 --legend-shift 0.02
	#python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c ${chan_tag}_preselCand -d ${distr} --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55  ${options} --title "" --title-x "#font[12]{p}^{miss}_{T} [GeV]" --title-y "${y_title}" --draw-overflows 5 --legend-shift 0.02
	#python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c ${chan_tag}_preselCand -d ${distr} --wjet 1.4 --qcd 1.05        --ratio-range 0.55  ${options} --title "" --title-x "#font[12]{p}^{miss}_{T} [GeV]" --title-y "${y_title}" --draw-overflows 5 --legend-shift 0.02  --sys TOPPTUp
	python stack_plot.py distrs/${nt}_${proc}_${distrs}_mc.root distrs/${nt}_${proc}_${distrs}/${datafile}.root -o plots/${nt}_${proc}_${distrs}/ -p -r --lumi ${lumi} --data-nick data_other -c ${chan_tag}_preselCand -d ${distr} --wjet 1.4 --qcd-factor 2.5  --ratio-range 0.55  ${options} --title "" --title-x "#font[12]{p}^{miss}_{T} [GeV]" --title-y "${y_title}" --draw-overflows 5 --legend-shift 0.02  --sys TOPPTUp

.ONESHELL:
rename_for_update_el_presel: nt=v37
rename_for_update_el_presel: proc=test13
rename_for_update_el_presel: distrs=update1
rename_for_update_el_presel: type=png
rename_for_update_el_presel:
	mkdir -p plots/${nt}_${proc}_${distrs}/renames/
	cd plots/${nt}_${proc}_${distrs}/renames/
	#ln -s ../*el_preselCand_*NOMINAL*dataqcd.${type} el_presel_b_discr_loose.${type}
	#ln -s ../*el_preselCand_*NOMINAL*dataqcd.${type} el_presel_b_discr_med.${type}
	#ln -s ../*el_preselCand_*NOMINAL*dataqcd.${type} el_presel_b_discr_rest.${type}
	ln -s ../*bjet_eta_el_preselCand_NOMINAL*dataqcd.${type} el_presel_bjet_eta.${type}
	ln -s ../*bjet_pt_el_preselCand_NOMINAL*dataqcd.${type}  el_presel_bjet_pt.${type}
	#ln -s ../*el_preselCand_*NOMINAL*dataqcd.${type} el_presel_bLjet_eta.${type}
	#ln -s ../*el_preselCand_*NOMINAL*dataqcd.${type} el_presel_bLjet_pt.${type}
	#ln -s ../*el_preselCand_*NOMINAL*dataqcd.${type} el_presel_bMjet_pt_toppt.${type}
	#ln -s ../*el_preselCand_*NOMINAL*dataqcd.${type} el_presel_dijet_mc_qcd.${type}
	#ln -s ../*el_preselCand_*NOMINAL*dataqcd.${type} el_presel_dijet.${type}
	#ln -s ../*el_preselCand_*NOMINAL*dataqcd.${type} el_presel_dijettrijet_mc_qcd.${type}
	#ln -s ../*el_preselCand_*NOMINAL*dataqcd.${type} el_presel_dijettrijet.${type}
	ln -s ../*lep_eta_el_preselCand_NOMINAL*dataqcd.${type} el_presel_electron_eta.${type}
	ln -s ../*lep_pt_el_preselCand_NOMINAL*dataqcd.${type}  el_presel_electron_pt.${type}
	#ln -s ../*el_preselCand_*NOMINAL*dataqcd.${type} el_presel_jet_cats.${type}
	#ln -s ../*el_preselCand_*NOMINAL*dataqcd.${type} el_presel_jet_eta.${type}
	#ln -s ../*el_preselCand_*NOMINAL*dataqcd.${type} el_presel_jet_pt.${type}
	ln -s ../*lep_eta_el_preselCand_NOMINAL*dataqcd.${type} el_presel_lep_eta.${type}
	ln -s ../*lep_pt_el_preselCand_NOMINAL*dataqcd.${type}  el_presel_lep_pt.${type}
	ln -s ../*lep_pt_el_preselCand_TOPPTUp*dataqcd.${type}  el_presel_lep_pt_toppt.${type}
	ln -s ../*on_met_c_el_preselCand_NOMINAL*dataqcd.${type}   el_presel_met.${type}
	ln -s ../*on_met_c_el_preselCand_TOPPTUp*dataqcd.${type}   el_presel_met_toppt.${type}
	#ln -s ../*el_preselCand_NOMINAL*dataqcd.${type} el_presel_M_lep_tau.${type}
	ln -s ../*Mt_lep_met_f_el_preselCand_NOMINAL*dataqcd.${type} el_presel_Mt_lep_met_f.${type}
	ln -s ../*Mt_lep_met_f_el_preselCand_NOMINAL*dataqcd.${type} el_presel_Mt_lep_met.${type}
	#ln -s ../*el_preselCand_NOMINAL*dataqcd.${type} el_presel_Mt_tau_met.${type}
	#ln -s ../*el_preselCand_NOMINAL*dataqcd.${type} el_presel_Mt_tau_pt_lj.${type}
	#ln -s ../*el_preselCand_NOMINAL*dataqcd.${type} el_presel_Mt_tau_pt_lt.${type}
	#ln -s ../*el_preselCand_NOMINAL*dataqcd.${type} el_presel_njets_a.${type}
	#ln -s ../*el_preselCand_NOMINAL*dataqcd.${type} el_presel_njets_l.${type}
	#ln -s ../*el_preselCand_NOMINAL*dataqcd.${type} el_presel_njets_m.${type}
	#ln -s ../*el_preselCand_NOMINAL*dataqcd.${type} el_presel_njets_r.${type}
	#ln -s ../*el_preselCand_NOMINAL*dataqcd.${type} el_presel_ntaus.${type}
	#ln -s ../*el_preselCand_NOMINAL*dataqcd.${type} el_presel_nvtx_down.${type}
	#ln -s ../*el_preselCand_NOMINAL*dataqcd.${type} el_presel_nvtx_init.${type}
	#ln -s ../*el_preselCand_NOMINAL*dataqcd.${type} el_presel_nvtx.${type}
	#ln -s ../*el_preselCand_NOMINAL*dataqcd.${type} el_presel_nvtx_up.${type}
	#ln -s ../*el_preselCand_NOMINAL*dataqcd.${type} el_presel_Rjet_eta.${type}
	#ln -s ../*el_preselCand_NOMINAL*dataqcd.${type} el_presel_Rjet_pt.${type}
	ln -s ../*tau_pt_el_preselCand_NOMINAL*dataqcd.${type} el_presel_tau_pt.${type}
	#ln -s ../*el_preselCand_NOMINAL*dataqcd.${type} el_presel_trijet_mc_qcd.${type}
	#ln -s ../*el_preselCand_NOMINAL*dataqcd.${type} el_presel_trijet.${type}
	# MC QCD
	ln -s ../*Mt_lep_met_f_el_preselCand_NOMINAL*ratio.${type} el_presel_Mt_lep_met_mc_qcd.${type}
	ln -s ../*lep_pt_el_preselCand_NOMINAL*ratio.${type}       el_presel_lep_pt_mc_qcd.${type}
	#ln -s ../*met_f_el_preselCand_NOMINAL*ratio.${type}       el_presel_met_mc_qcd.${type}

.ONESHELL:
rename_for_update_mu_presel: nt=v37
rename_for_update_mu_presel: proc=test13
rename_for_update_mu_presel: distrs=update1
rename_for_update_mu_presel: type=png
rename_for_update_mu_presel:
	mkdir -p plots/${nt}_${proc}_${distrs}/renames/
	cd plots/${nt}_${proc}_${distrs}/renames/
	ln -s ../*bjet_eta_mu_preselCand_NOMINAL*dataqcd.${type} mu_presel_bjet_eta.${type}
	ln -s ../*bjet_pt_mu_preselCand_NOMINAL*dataqcd.${type}  mu_presel_bjet_pt.${type}
	ln -s ../*lep_eta_mu_preselCand_NOMINAL*dataqcd.${type} mu_presel_electron_eta.${type}
	ln -s ../*lep_pt_mu_preselCand_NOMINAL*dataqcd.${type}  mu_presel_electron_pt.${type}
	ln -s ../*lep_eta_mu_preselCand_NOMINAL*dataqcd.${type} mu_presel_lep_eta.${type}
	ln -s ../*lep_pt_mu_preselCand_NOMINAL*dataqcd.${type}  mu_presel_lep_pt.${type}
	ln -s ../*lep_pt_mu_preselCand_TOPPTUp*dataqcd.${type}  mu_presel_lep_pt_toppt.${type}
	ln -s ../*on_met_c_mu_preselCand_NOMINAL*dataqcd.${type}   mu_presel_met.${type}
	ln -s ../*on_met_c_mu_preselCand_TOPPTUp*dataqcd.${type}   mu_presel_met_toppt.${type}
	ln -s ../*Mt_lep_met_f_mu_preselCand_NOMINAL*dataqcd.${type} mu_presel_Mt_lep_met_f.${type}
	ln -s ../*Mt_lep_met_f_mu_preselCand_NOMINAL*dataqcd.${type} mu_presel_Mt_lep_met.${type}
	ln -s ../*tau_pt_mu_preselCand_NOMINAL*dataqcd.${type} mu_presel_tau_pt.${type}
	#
	ln -s ../*Mt_lep_met_f_mu_preselCand_NOMINAL*ratio.${type} mu_presel_Mt_lep_met_mc_qcd.${type}
	ln -s ../*lep_pt_mu_preselCand_NOMINAL*ratio.${type}       mu_presel_lep_pt_mc_qcd.${type}
	#ln -s ../*met_f_mu_preselCand_NOMINAL*ratio.${type}       mu_presel_met_mc_qcd.${type}

.ONESHELL:
rename_for_update_main_sel: nt=v37
rename_for_update_main_sel: proc=test13
rename_for_update_main_sel: distrs=update1
rename_for_update_main_sel: lepton=mu
rename_for_update_main_sel: type=png
rename_for_update_main_sel:
	mkdir -p plots/${nt}_${proc}_${distrs}/renames/
	cd plots/${nt}_${proc}_${distrs}/renames/
	#ln -s ../*bjet_eta_${lepton}_sel_NOMINAL*dataqcd.${type} ${lepton}_sel_bjet_eta.${type}
	#ln -s ../*bjet_pt_${lepton}_sel_NOMINAL*dataqcd.${type}  ${lepton}_sel_bjet_pt.${type}
	ln -s ../*lep_eta_${lepton}_sel_NOMINAL*dataqcd.${type} ${lepton}_sel_lep_eta.${type}
	ln -s ../*lep_pt_${lepton}_sel_NOMINAL*dataqcd.${type}  ${lepton}_sel_lep_pt.${type}
	ln -s ../*tau_eta_${lepton}_sel_NOMINAL*dataqcd.${type} ${lepton}_sel_tau_eta.${type}
	ln -s ../*tau_pt_${lepton}_sel_NOMINAL*dataqcd.${type}  ${lepton}_sel_tau_pt.${type}
	ln -s ../*on_met_c_${lepton}_sel_NOMINAL*dataqcd.${type}   ${lepton}_sel_met.${type}
	ln -s ../*Mt_lep_met_f_${lepton}_sel_NOMINAL*dataqcd.${type} ${lepton}_sel_Mt_lep_met_f.${type}
	ln -s ../*Mt_lep_met_c_${lepton}_sel_NOMINAL*dataqcd.${type} ${lepton}_sel_Mt_lep_met.${type}
	ln -s ../*Mt_lep_met_c_${lepton}_sel_lj_NOMINAL*dataqcd.${type}    ${lepton}_sel_lj_Mt_lep_met.${type}
	ln -s ../*Mt_lep_met_c_${lepton}_sel_ljout_NOMINAL*dataqcd.${type} ${lepton}_sel_ljout_Mt_lep_met.${type}

rename_for_update_mu_sel:
	make rename_for_update_main_sel lepton=mu

rename_for_update_el_sel:
	make rename_for_update_main_sel lepton=el

.ONESHELL:
rename_for_update_wjets: nt=v37
rename_for_update_wjets: proc=test13
rename_for_update_wjets: distrs=update1
rename_for_update_wjets: type=png
rename_for_update_wjets:
	mkdir -p plots/${nt}_${proc}_${distrs}/renames/
	cd plots/${nt}_${proc}_${distrs}/renames/
	#ln -s ../*lep_pt_wjets_mu_NOMINAL*dataqcd.${type}       wjets_mu_lep_pt.${type}
	#ln -s ../*met_c_wjets_mu_NOMINAL*dataqcd.${type}        wjets_mu_met.${type}
	ln -s ../*lep_pt_wjets_mu_NOMINAL*ratio.${type}         wjets_mu_lep_pt.${type}
	ln -s ../*on_met_c_wjets_mu_NOMINAL*ratio.${type}          wjets_mu_met.${type}
	ln -s ../*Mt_lep_met_c_wjets_mu_NOMINAL*ratio.${type}   wjets_mu_Mt_lep_met.${type}
	ln -s ../*Mt_lep_met_c_wjets_mu_NOMINAL*dataqcd.${type} wjets_mu_Mt_lep_met_datadriven_qcd.${type}
	#
	ln -s ../*lep_pt_wjets_el_NOMINAL*ratio.${type}         wjets_el_lep_pt.${type}
	ln -s ../*on_met_c_wjets_el_NOMINAL*ratio.${type}          wjets_el_met.${type}
	ln -s ../*Mt_lep_met_c_wjets_el_NOMINAL*ratio.${type}   wjets_el_Mt_lep_met.${type}
	ln -s ../*Mt_lep_met_c_wjets_el_NOMINAL*dataqcd.${type} wjets_el_Mt_lep_met_datadriven_qcd.${type}

.ONESHELL:
rename_for_update_dileptons: nt=v37
rename_for_update_dileptons: proc=test13
rename_for_update_dileptons: distrs=update1
rename_for_update_dileptons: type=png
rename_for_update_dileptons:
	mkdir -p plots/${nt}_${proc}_${distrs}/renames/
	cd plots/${nt}_${proc}_${distrs}/renames/
	ln -s ../*lep_pt_dy_mumu_NOMINAL*ratio.${type}         dy_lep_pt.${type}
	ln -s ../*Mt_lep_met_c_dy_mumu_NOMINAL*ratio.${type}   dy_Mt_lep_met.${type}
	ln -s ../*lep_pt_dy_mumu_NOMINAL*ratio.${type}         dy_mumu_lep_pt.${type}
	ln -s ../*Mt_lep_met_c_dy_mumu_NOMINAL*ratio.${type}   dy_mumu_Mt_lep_met.${type}
	ln -s ../*lep_pt_dy_elel_NOMINAL*ratio.${type}         dy_elel_lep_pt.${type}
	ln -s ../*Mt_lep_met_c_dy_elel_NOMINAL*ratio.${type}   dy_elel_Mt_lep_met.${type}
	# tt_elmu
	ln -s ../*Mt_lep_met_c_tt_elmu_NOMINAL*ratio.${type} elmu_Mt_lep_met.${type}
	ln -s ../*Muon_met_c_tt_elmu_NOMINAL*ratio.${type}        elmu_met.${type}
	ln -s ../*lep_pt_tt_elmu_NOMINAL*ratio.${type}       elmu_lep_pt.${type}
	ln -s ../*Mt_lep_met_c_tt_elmu_TOPPTUp*ratio.${type} elmu_Mt_lep_met_TOPPTUp.${type}
	ln -s ../*Muon_met_c_tt_elmu_TOPPTUp*ratio.${type}        elmu_met_TOPPTUp.${type}
	ln -s ../*lep_pt_tt_elmu_TOPPTUp*ratio.${type}       elmu_lep_pt_TOPPTUp.${type}

.ONESHELL:
rename_for_update_dy_tautau: nt=v37
rename_for_update_dy_tautau: proc=test13
rename_for_update_dy_tautau: distrs=update1
rename_for_update_dy_tautau: type=png
rename_for_update_dy_tautau:
	mkdir -p plots/${nt}_${proc}_${distrs}/renames/
	cd plots/${nt}_${proc}_${distrs}/renames/
	# dy_tautau
	ln -s ../*lep_pt_dy_eltau_NOMINAL*.${type}       dy_eltau_lep_pt.${type}
	ln -s ../*lep_eta_dy_eltau_NOMINAL*.${type}      dy_eltau_lep_eta.${type}
	ln -s ../*Mt_lep_met_c_dy_eltau_NOMINAL*.${type} dy_eltau_Mt_lep_met.${type}
	ln -s ../*lep_pt_dy_eltau_NOMINAL*.${type}       dy_eltau_tau_pt.${type}
	ln -s ../*lep_pt_dy_eltau_3j_NOMINAL*.${type}       dy_eltau_3j_lep_pt.${type}
	ln -s ../*lep_eta_dy_eltau_3j_NOMINAL*.${type}      dy_eltau_3j_lep_eta.${type}
	ln -s ../*Mt_lep_met_c_dy_eltau_3j_NOMINAL*.${type} dy_eltau_3j_Mt_lep_met.${type}
	ln -s ../*lep_pt_dy_eltau_3j_NOMINAL*.${type}       dy_eltau_3j_tau_pt.${type}
	ln -s ../*lep_pt_dy_mutau_NOMINAL*.${type}       dy_mutau_lep_pt.${type}
	ln -s ../*lep_eta_dy_mutau_NOMINAL*.${type}      dy_mutau_lep_eta.${type}
	ln -s ../*Mt_lep_met_c_dy_mutau_NOMINAL*.${type} dy_mutau_lep_Mt_lep_met.${type}
	ln -s ../*lep_pt_dy_mutau_NOMINAL*.${type}       dy_mutau_tau_pt.${type}
	ln -s ../*lep_pt_dy_mutau_3j_NOMINAL*.${type}       dy_mutau_3j_lep_pt.${type}
	ln -s ../*lep_eta_dy_mutau_3j_NOMINAL*.${type}      dy_mutau_3j_lep_eta.${type}
	ln -s ../*Mt_lep_met_c_dy_mutau_3j_NOMINAL*.${type} dy_mutau_3j_Mt_lep_met.${type}
	ln -s ../*lep_pt_dy_mutau_3j_NOMINAL*.${type}       dy_mutau_3j_tau_pt.${type}

.ONESHELL:
rename_for_update_paper_plots: nt=v37
rename_for_update_paper_plots: proc=test13
rename_for_update_paper_plots: distrs=update1
rename_for_update_paper_plots: type=png
rename_for_update_paper_plots:
	mkdir -p plots/${nt}_${proc}_${distrs}/renames/
	cd plots/${nt}_${proc}_${distrs}/renames/
	#
	ln -s ../paper/*Mt_lep_met_c_mu_sel*.${type} paper_mu_sel_Mt.${type}
	ln -s ../paper/*Mt_lep_met_c_el_sel*.${type} paper_el_sel_Mt.${type}

rename_for_update: nt=v37
rename_for_update: proc=test13
rename_for_update: distrs=update1
rename_for_update: type=png
rename_for_update: rename_for_update_mu_presel rename_for_update_el_presel rename_for_update_wjets rename_for_update_dileptons rename_for_update_el_sel rename_for_update_mu_sel rename_for_update_dy_tautau

test_controls_v37_test5_issue1: tests=tests1
test_controls_v37_test5_issue1: mc=distrs/v37_test5_bunch2_mc_wjets_wNjets.root
test_controls_v37_test5_issue1: data_dir=distrs/v37_test5_bunch2/
test_controls_v37_test5_issue1:
	mkdir -p plots/v37_test5_bunch2_mc_${tests}/
	# presel
	python stack_plot.py ${mc} ${data_dir}/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c mu_presel       --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd-factor 1.5
	python stack_plot.py ${mc} ${data_dir}/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c el_presel       --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd-factor 1.5
	python stack_plot.py ${mc} ${data_dir}/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c mu_presel_lj    --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd-factor 1.5
	python stack_plot.py ${mc} ${data_dir}/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c el_presel_lj    --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd-factor 1.5
	python stack_plot.py ${mc} ${data_dir}/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c mu_presel_ljout --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd-factor 1.5
	python stack_plot.py ${mc} ${data_dir}/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c el_presel_ljout --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd-factor 1.5
	python stack_plot.py ${mc} ${data_dir}/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c mu_preselCand   --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd-factor 1.5
	python stack_plot.py ${mc} ${data_dir}/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c el_preselCand   --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd-factor 1.5
	python stack_plot.py ${mc} ${data_dir}/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c mu_preselCand   --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd 1.05
	python stack_plot.py ${mc} ${data_dir}/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c el_preselCand   --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd 1.05
	python stack_plot.py ${mc} ${data_dir}/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c mu_preselCand   --data-nick data_other -d Mt_lep_met_c2 --lumi 35800 --overwrite --wjets 0.8 --qcd-factor 1.5
	python stack_plot.py ${mc} ${data_dir}/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c el_preselCand   --data-nick data_other -d Mt_lep_met_c2 --lumi 35800 --overwrite --wjets 0.8 --qcd-factor 1.5
	python stack_plot.py ${mc} ${data_dir}/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c mu_preselCand   --data-nick data_other -d Mt_lep_met_c2 --lumi 35800 --overwrite --wjets 0.8 --qcd 1.05
	python stack_plot.py ${mc} ${data_dir}/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c el_preselCand   --data-nick data_other -d Mt_lep_met_c2 --lumi 35800 --overwrite --wjets 0.8 --qcd 1.05
	# sel
	python stack_plot.py ${mc} ${data_dir}/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c mu_sel       --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05
	python stack_plot.py ${mc} ${data_dir}/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c el_sel       --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05
	python stack_plot.py ${mc} ${data_dir}/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c mu_sel       --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05
	python stack_plot.py ${mc} ${data_dir}/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c el_sel       --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05
	python stack_plot.py ${mc} ${data_dir}/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c mu_sel       --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05
	python stack_plot.py ${mc} ${data_dir}/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c el_sel       --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05
	# lj categories
	python stack_plot.py ${mc} ${data_dir}/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c mu_sel_lj    --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 0.0001
	python stack_plot.py ${mc} ${data_dir}/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c el_sel_lj    --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 0.0001
	python stack_plot.py ${mc} ${data_dir}/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c mu_sel_ljout --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 0.0001
	python stack_plot.py ${mc} ${data_dir}/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c el_sel_ljout --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 0.0001
	# other
	# tt_elmu
	python stack_plot.py ${mc} ${data_dir}/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c tt_elmu --data-nick data_other -d Mt_lep_met_f --lumi 35800 --overwrite --wjets 0.8
	python stack_plot.py ${mc} ${data_dir}/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c tt_elmu --data-nick data_other -d Mt_lep_met_f --lumi 35800 --overwrite --wjets 0.8
	# check the effect of top pT
	python stack_plot.py ${mc} ${data_dir}/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c tt_elmu --data-nick data_other -d Mt_lep_met_f --lumi 35800 --overwrite --wjets 0.8 --systematic TOPPTUp
	# the source of the difference in the shape
	python stack_plot.py ${mc} ${data_dir}/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c tt_elmu --data-nick data_other -d lep_pt  --lumi 35800 --overwrite --wjets 0.8
	python stack_plot.py ${mc} ${data_dir}/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c tt_elmu --data-nick data_other -d lep_pt  --lumi 35800 --overwrite --wjets 0.8
	python stack_plot.py ${mc} ${data_dir}/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c tt_elmu --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.8
	python stack_plot.py ${mc} ${data_dir}/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c tt_elmu --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.8
	python stack_plot.py ${mc} ${data_dir}/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c tt_elmu --data-nick data_other -d met_c   --lumi 35800 --overwrite --wjets 0.8
	python stack_plot.py ${mc} ${data_dir}/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c tt_elmu --data-nick data_other -d met_c   --lumi 35800 --overwrite --wjets 0.8
	# dy
	python stack_plot.py ${mc} ${data_dir}/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c dy_mumu --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
	python stack_plot.py ${mc} ${data_dir}/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c dy_elel --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
	python stack_plot.py ${mc} ${data_dir}/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c dy_mumu --data-nick data_other -d met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
	python stack_plot.py ${mc} ${data_dir}/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c dy_elel --data-nick data_other -d met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
	python stack_plot.py ${mc} ${data_dir}/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c dy_mumu --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
	python stack_plot.py ${mc} ${data_dir}/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c dy_elel --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
	# wjets
	python stack_plot.py ${mc} ${data_dir}/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c wjets_mu --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
	python stack_plot.py ${mc} ${data_dir}/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c wjets_el --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
	python stack_plot.py ${mc} ${data_dir}/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c wjets_mu --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
	python stack_plot.py ${mc} ${data_dir}/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_${tests}/  -c wjets_el --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5




